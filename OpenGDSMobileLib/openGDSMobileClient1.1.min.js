/* 2015-03-11 */ var OGDSM=OGDSM||{};OGDSM=function(){"use strict";return OGDSM.prototype={constructor:OGDSM,version:"1.0"},OGDSM}(window,jQuery),OGDSM.namesapce=function(a){"use strict";var b,c=a.split("."),d=OGDSM;for("OGDSM"===d[0]&&(c=c.slice(1)),b=0;b<c.length;b+=1)"undefined"==typeof d[c[b]]&&(d[c[b]]={}),d=d[c[b]];return d},OGDSM.jsonToArray=function(a,b,c){"use strict";var d=[],e=a.row;return d[0]=[],d[1]=[],$.each(e,function(a){d[0].push(e[a][b]),d[1].push(e[a][c])}),d},OGDSM.namesapce("visualization"),function(a,b){"use strict";var c;return b.visualization=function(a){c=a},b.visualization.prototype={constructor:b.olMap,getMap:function(){return c},layerCheck:function(a){var b,c=this.getMap().getLayers().getArray();for(b=0;b<c.length;b+=1)if(c[b].get("title")===a)return c[b];return!1}},b.visualization}(ol,OGDSM),OGDSM.visualization.prototype.changeBaseMap=function(a){"use strict";var b=null,c=null,d=null,e=this.getMap(),f=e.getLayers(),g=e.getView().getCenter(),h=e.getView().getZoom(),i=e.getView().getProjection();f.forEach(function(a){var b=a.get("title");"basemap"===b&&(d=a)}),"OSM"===a?(b=new ol.source.OSM,c=new ol.View({projection:i,center:g,zoom:h})):"VWorld"===a?(b=new ol.source.XYZ({url:"http://xdworld.vworld.kr:8080/2d/Base/201310/{z}/{x}/{y}.png"}),c=new ol.View({projection:i,center:g,zoom:h})):console.log("Not Map Style"),console.log(b),null!==d&&(e.setView(c),d.setSource(b))},OGDSM.visualization.prototype.addMap=function(a){"use strict";var b=this.layerCheck(a.get("title"));null!==b&&this.getMap().removeLayer(b),this.getMap().addLayer(a)},OGDSM.visualization.prototype.removeMap=function(a){"use strict";var b=this.layerCheck(a);this.getMap().removeLayer(b)},OGDSM.visualization.prototype.changeWFSStyle=function(a,b,c,d,e,f,g){"use strict";d="undefined"!=typeof d?d:.5,e="undefined"!=typeof e?e:null,f="undefined"!=typeof e?f:null,g="undefined"!=typeof e?g:null;var h=this.layerCheck(a),i={};return h===!1?-1:(h.setStyle(function(a,d){var h,j,k="#FFFFFF",l=5e3>d?a.get(e):"";if(!i[l]){if(Array.isArray(b)){for(h=0;h<g[1].length;h+=1)if(l===g[1][h])for(j=0;j<f.length;j+=1)if(g[0][h]<=f[j]){k=b[j];break}}else k=b;"polygon"===c?i[l]=[new ol.style.Style({fill:new ol.style.Fill({color:k}),stroke:new ol.style.Stroke({color:"#00000",width:1}),text:new ol.style.Text({font:"9px Calibri,sans-serif",text:l,fill:new ol.style.Fill({color:"#000000"})})})]:"point"===c&&(i[l]=[new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:k}),stroke:new ol.style.Stroke({color:"#000000",width:1})})})])}return i[l]}),void h.setOpacity(d))},OGDSM.visualization.prototype.barChart=function(a,b,c,d){"use strict";c="undefined"!=typeof c?c:[],d="undefined"!=typeof d?d:["#000000"];var e=18,f=0,g=$("#"+a),h=d3.max(b[0]),i=null,j=null,k=null;g.empty(),i=d3.select("#"+a).append("svg").attr("id","barchart").attr("width",g.width()).attr("height",e*b[0].length),j=d3.scale.linear().domain([0,h]).range([0,g.width()-50]),i.selectAll("rect").data(b[0]).enter().append("rect").attr("x",0).attr("y",function(a,b){return b*e}).attr("width",function(a){return"-"===a||"0"===a?j(20):j(a)-f}).attr("height",e-2).attr("fill",function(a,e){if("-"===a||"0"===a)return"#AAAAAA";if(0!==c.length)for(k=0;k<c.length;k+=1)if(b[0][e]<=c[k])return d[k];return d[d.length]}),i.selectAll("g").data(b[1]).enter().append("text").attr("x",0).attr("y",function(a,b){return b*e+e-5}).attr("font-weight","bold").attr("font-size","0.8em").text(function(a){return a}),i.selectAll("g").data(b[0]).enter().append("text").attr("x",function(a){return"-"===a||"0"===a?j(10):j(a)-f}).attr("y",function(a,b){return b*e+e-5}).attr("dy",".15em").attr("fill","black").attr("font-size","0.8em").attr("font-weight","bold").text(function(a){return"-"===a||"0"===a?"점검중":a})},OGDSM.visualization.prototype.imageLayer=function(a,b,c,d){"use strict";var e=null,f=b;e=new ol.layer.Image({opacity:1,title:f,source:new ol.source.ImageStatic({url:a+"?"+Math.random(),imageSize:c,projection:new ol.proj.Projection({code:"EPSG:3857"}),imageExtent:d})}),this.getMap().addLayer(e)},OGDSM.namesapce("externalConnection"),function(a){"use strict";var b=[],c=null;return a.externalConnection=function(a,b){b="undefined"!=typeof b?b:"null",this.serverName=a,this.asyncValue=!1,this.baseAddr="vworldWMS"===a?"http://map.vworld.kr/js/wms.do":b},a.externalConnection.prototype={constructor:a.externalConnection,getValues:function(){return b},setValues:function(a){b=a},removeValues:function(){b=[]},getResponseData:function(){return c},setResponseData:function(a){c=null,c=a},setSubName:function(a){this.subName=a}},a.externalConnection}(OGDSM),OGDSM.externalConnection.prototype.changeServer=function(a,b){"use strict";b="undefined"!=typeof b?b:"undefined",this.serverName=a,this.baseAddr="vworldWMS"===a?"http://map.vworld.kr/js/wms.do":b},OGDSM.externalConnection.prototype.setData=function(){"use strict";var a,b,c;for(a=arguments,this.removeValues(),c=this.getValues(),b=0;b<a.length;b+=1)c.push(a[b]);this.setValues(c)},OGDSM.externalConnection.prototype.dataLoad=function(){"use strict";var a=null,b=null,c=this.getValues(),d=this.setResponseData;if("vworldWMS"===this.serverName)3===c.length?(a=new ol.layer.Tile({title:this.serverName,source:new ol.source.TileWMS({url:this.baseAddr,params:{apiKey:c[0],domain:c[1],LAYERS:c[2],STYLES:c[2],FORMAT:"image/png",CRS:"EPSG:3857",EXCEPTIONS:"text/xml",TRANSPARENT:!0}})}),d(a)):console.log("Not check out data values");else if("geoServer"===this.serverName){if("undefined"===this.subName)return console.log("Please setting subName"),!1;"getLayers"===this.subName?(b={WorkspaceName:c[0]},$.ajax({type:"POST",url:this.baseAddr,crossDomain:!0,data:JSON.stringify(b),contentType:"application/json;charset=UTF-8",dataType:"json",success:function(b){a=b,d(a.data)},error:function(a){console.log(a)}})):"WFS"===this.subName&&(console.log(c[0]+", "+c[1]+","+c[2]),a=this.geoServerWFS(this.baseAddr,c[0],c[1],c[2]),d(a))}else"publicData"===this.serverName&&("TimeAverageAirQuality"===this.subName||"RealtimeRoadsideStation"===this.subName||"ArpltnInforInqireSvc"===this.subName)&&this.publicDataEnv(c[0],c[1],c[2],c[3]);return null===this.getResponseData()?!1:!0},OGDSM.externalConnection.prototype.geoServerWFS=function(a,b,c,d){d="undefined"!=typeof d?d:"polygon";var e,f,g;return e=new ol.source.ServerVector({format:new ol.format.GeoJSON,loader:function(d){var e=a+"/geoserver/wfs?service=WFS&version=1.1.0&request=GetFeature&typeNames="+b+":"+c+"&outputFormat=text/javascript&format_options=callback:loadFeatures&srsname=EPSG:3857&bbox="+d.join(",")+",EPSG:3857";$.ajax({url:e,dataType:"jsonp"})},strategy:ol.loadingstrategy.createTile(new ol.tilegrid.XYZ({maxZoom:19})),projection:"EPSG:3857"}),"polygon"===d?f=[new ol.style.Style({fill:new ol.style.Fill({color:"#ff0000"}),stroke:new ol.style.Stroke({color:"#000000",width:1})})]:"point"===d&&(f=[new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#ff0000"}),stroke:new ol.style.Stroke({color:"#ff0000",width:1})})})]),loadFeatures=function(a){e.addFeatures(e.readFeatures(a))},g=new ol.layer.Vector({title:c,source:e,style:f})},OGDSM.externalConnection.prototype.publicDataEnv=function(a,b,c,d){"use strict";c="undefined"!=typeof c?c:"null",d="undefined"!=typeof d?d:"null";var e="",f=this.setResponseData;$("#setting").popup("close"),"TimeAverageAirQuality"===this.subName?e='{"serviceName":"'+this.subName+'", "keyValue":"'+a+'","dateValue":"'+c+'","envType":"'+b+'","timeValue":"'+d+'"}':"ArpltnInforInqireSvc"===this.subName&&(e='{"serviceName":"'+this.subName+'", "keyValue":"'+a+'","areaType":"'+encodeURIComponent(c)+'","envType":"'+b+'"}'),console.log(e),e=JSON.parse(e),$.ajax({type:"POST",url:this.baseAddr,data:JSON.stringify(e),async:this.asyncValue,contentType:"application/json;charset=UTF-8",dataType:"json",success:function(a){var b=a;f(JSON.parse(b.data))},error:function(a){console.log(a)}})},OGDSM.namesapce("eGovFrameUI"),function(a){"use strict";return a.eGovFrameUI=function(a){a="undefined"!=typeof a?a:null,this.dataTheme=null!==a?a:"c"},a.eGovFrameUI.prototype={constructor:a.eGovFrameUI},a.eGovFrameUI}(OGDSM),OGDSM.eGovFrameUI.prototype.vworldWMSCheck=function(a,b){"use strict";var c,d,e,f,g="undefined"!=typeof b?b:this.dataTheme,h=$("#"+a),i='<fieldset data-role="controlgroup">',j=(this.OGDSM,["vworldWMSChk_1","vworldWMSChk_2","vworldWMSChk_3","vworldWMSChk_4","vworldWMSChk_5"]),k=[0,0,0,0,0];for(c=["LP_PA_CBND_BUBUN,LP_PA_CBND_BONBUN","LT_C_UQ111","LT_C_UQ112","LT_C_UQ113","LT_C_UQ114","LT_C_UQ121","LT_C_UQ122","LT_C_UQ123","LT_C_UQ124","LT_C_UQ125","LT_C_UQ126","LT_C_UQ127","LT_C_UQ128","LT_C_UQ129","LT_C_UQ130","LT_C_UQ141","LT_C_UQ162","LT_C_UD801","LT_L_MOCTLINK","LT_P_MOCTNODE","LT_C_LHZONE","LT_C_LHBLPN","LT_P_MGPRTFA","LT_P_MGPRTFB","LT_P_MGPRTFC","LT_P_MGPRTFD","LT_L_SPRD","LT_C_SPBD","LT_C_ADSIDO","LT_C_ADSIGG","LT_C_ADEMD","LT_C_ADRI","LT_C_TDWAREA","LT_C_DAMDAN","LT_C_DAMYOD","LT_C_DAMYOJ","LT_C_DAMYUCH","LT_C_RIRSV","LT_P_RIFCT","LT_P_UTISCCTV","LT_C_USFSFFB","LT_L_FRSTCLIMB","LT_P_CLIMBALL","LT_L_TRKROAD","LT_P_TRKROAD","LT_C_WKMBBSN","LT_C_WKMMBSN","LT_C_WKMSBSN","LT_C_WKMSTRM","LT_C_ASITSOILDRA","LT_C_ASITDEEPSOIL","LT_C_ASITSOILDEP","LT_C_ASITSURSTON","LT_L_AISROUTEU","LT_L_AISPATH","LT_C_AISALTC","LT_C_AISRFLC","LT_C_AISACMC","LT_C_AISCTRC","LT_C_AISMOAC","LT_C_AISADZC","LT_C_AISPRHC","LT_C_AISFIRC","LT_C_AISRESC","LT_C_AISDNGC","LT_C_AISTMAC","LT_C_AISCATC","LT_P_AISBLDG40F","LT_L_AISSEARCHL,LT_P_AISSEARCHP","LT_L_AISVFRPATH,LT_P_AISVFRPATH","LT_P_AISVFRPT,LT_P_AISVFRPT_SW,LT_P_AISVFRPT_SN","LT_L_AISCORRID_YS,LT_L_AISCORRID_GJ,LT_P_AISCORRID_YS,LT_P_AISCORRID_GJ","LT_P_AISHCSTRIP"],d=["지적도","도시지역","관리지역","농립지역","자연환경보전지역","경관지구","미관지구","고도지구","방화지구","방재지구","보존지구","시설보호지구","취락지구","개발진흥지구","특정용도제한지구","국토계획구역","도시자연공원구역","개발제한구역","교통링크","교통노드","사업지구경계도","토지이용계획도","아동안전지킴이집","노인복지시설","아동복지시설","기타보호시설","새주소도로","새주소건물","광역시도","시군구","읍면동","리","보행우선구역","단지경계","단지용도지역","단지시설용지","단지유치업종","저수지","수리시설","교통CCTV","소방서관할구역","등산로","등산로시설","둘레길링크","산책로분기점","대권역","중권역","표준권역","하천망","배수등급","심토토성","유효토심","자갈함량","제한고도","항공로","경계구역","공중급유구역","공중전투기동훈련장","관제권","군작전구역","방공식별구역","비행금지구역","비행정보구역","비행제한구역","위험구역","접근관제구역","훈련구역","건물군(40층이상)","수색비행장비행구역","시계비행로","시계비행보고지점","한강회랑","헬기장"],f=0;f<j.length;f+=1){for(i+='<select name="'+j[f]+'" id="'+j[f]+'" data-theme='+g+">",i+='<option value="">'+(f+1)+"번째 레이어 선택 </option>",e=0;e<c.length;e+=1)i+='<option value="'+c[e]+'">'+d[e]+"</option>";i+="</select>"}return i+="</fieldset>",h.append(i),h.trigger("create"),$("#"+j[0]).change(function(){for(k[0]=this.selectedIndex,$("#"+j[0]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[1]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[2]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[3]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[4]+" option").each(function(){$(this).removeAttr("disabled")}),f=0;f<k.length;f+=1)for(e=0;e<j.length;e+=1)$("#"+j[e]+" option:eq("+k[f]+")").attr("disabled","disabled")}),$("#"+j[1]).change(function(){for(k[1]=this.selectedIndex,$("#"+j[0]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[1]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[2]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[3]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[4]+" option").each(function(){$(this).removeAttr("disabled")}),f=0;f<k.length;f+=1)for(e=0;e<j.length;e+=1)$("#"+j[e]+" option:eq("+k[f]+")").attr("disabled","disabled")}),$("#"+j[2]).change(function(){for(k[2]=this.selectedIndex,$("#"+j[0]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[1]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[2]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[3]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[4]+" option").each(function(){$(this).removeAttr("disabled")}),f=0;f<k.length;f+=1)for(e=0;e<j.length;e+=1)$("#"+j[e]+" option:eq("+k[f]+")").attr("disabled","disabled")}),$("#"+j[3]).change(function(){for(k[3]=this.selectedIndex,$("#"+j[0]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[1]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[2]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[3]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[4]+" option").each(function(){$(this).removeAttr("disabled")}),f=0;f<k.length;f+=1)for(e=0;e<j.length;e+=1)$("#"+j[e]+" option:eq("+k[f]+")").attr("disabled","disabled")}),$("#"+j[4]).change(function(){for(k[4]=this.selectedIndex,$("#"+j[0]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[1]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[2]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[3]+" option").each(function(){$(this).removeAttr("disabled")}),$("#"+j[4]+" option").each(function(){$(this).removeAttr("disabled")}),f=0;f<k.length;f+=1)for(e=0;e<j.length;e+=1)$("#"+j[e]+" option:eq("+k[f]+")").attr("disabled","disabled")}),j},OGDSM.eGovFrameUI.prototype.visTypeRadio=function(a,b){"use strict";var c,d="undefined"!=typeof b?b:this.dataTheme,e=$("#"+a),f='<fieldset data-role="controlgroup" data-type="horizontal" class="egov-align-center">',g=["map","chart"],h=["맵","차트"];for(c=0;c<g.length;c+=1)f+='<input type="radio" name="visualType" class="custom" data-theme='+d+' id="id-'+g[c]+'" value="'+g[c]+'" ',f+='><label for="id-'+g[c]+'">'+h[c]+"</label>";return e.append(f),e.trigger("create"),"visualType"},OGDSM.eGovFrameUI.prototype.dateInput=function(a){"use strict";var b,c;return b=$("#"+a),c='<label for="dateValue">날짜 : </label><input type="date" id="dateValue"/>',b.append(c),b.trigger("create"),$("#dateValue")},OGDSM.eGovFrameUI.prototype.timeInput=function(a){"use strict";var b,c;return b=$("#"+a),c='<label for="timeValue">시간 : </label><input type="time" id="timeValue">',b.append(c),b.trigger("create"),$("#timeValue")},OGDSM.eGovFrameUI.prototype.envTypeRadio=function(a,b,c){"use strict";var d,e,f="undefined"!=typeof b?b:"seoul",g="undefined"!=typeof c?c:this.dataTheme,h=$("#"+a),i='<label for="envValue">환경정보:</label><fieldset data-role="controlgroup" data-type="horizontal" class="egov-align-center">',j=["pm10","pm25","so2","o3","no2","co"];for("seoul"===f?d=["PM10","PM25","SO2","O3","NO2","CO"]:"public"===f&&(d=["pm10Value","pm25Value","so2Value","o3Value","no2Value","coValue"]),e=0;e<j.length;e+=1)i+='<input type="radio" name="envTypeRadio" class="custom" data-theme='+g+' id="id-'+d[e]+'" value="'+d[e]+'"/><label for="id-'+d[e]+'"><img src="images/input_bt_'+j[e]+'.png" width=30></label>',0!==e&&(e+1)%3===0&&(i+='</fieldset><fieldset data-role="controlgroup" data-type="horizontal" class="egov-align-center">');return h.append(i),h.trigger("create"),"envTypeRadio"},OGDSM.eGovFrameUI.prototype.areaTypeRadio=function(a,b){"use strict";var c,d=("undefined"!=typeof b?b:this.dataTheme,$("#"+a)),e='<label for="areaValue">지역:</label><fieldset data-role="controlgroup" data-type="horizontal" class="egov-align-center">',f=["인천","서울","경기","강원","충남","세종","충북","대전","경북","전북","대구","울산","전남","광주","경남","부산","제주"];for(c=0;c<f.length;c+=1)e+='<input type="radio" name="areaTypeRadio" class="custom" data-theme='+this.dataTheme+' id="id-'+f[c]+'" value="'+f[c]+'"/><label for="id-'+f[c]+'">'+f[c]+"</label>",0!==c&&(c+1)%3===0&&(e+='</fieldset><fieldset data-role="controlgroup" data-type="horizontal" class="egov-align-center">');return e+="</fieldset>",d.append(e),d.trigger("create"),"areaTypeRadio"},OGDSM.eGovFrameUI.prototype.mapListSelect=function(a,b){"use strict";var c,d,e=$("#"+a);for(console.log(b),c='<select name="geoServerSelectBox" id="geoServerSelectBox" data-theme='+this.dataTheme+'><option value=""></option>',d=0;d<b.length;d+=1)c+='<option value="'+b[d]+'">'+b[d]+"</option>";return c+="</select>",e.append(c),e.trigger("create"),"geoServerSelectBox"},OGDSM.eGovFrameUI.prototype.processButton=function(a,b){"use strict";var c,d,e="undefined"!=typeof b?b:this.dataTheme;return c=$("#"+a),d='<a href="#" id="processBtn" data-role="button" data-theme="'+e+'">시각화</a>',c.append(d),c.trigger("create"),$("#processBtn")},OGDSM.eGovFrameUI.prototype.selectBox=function(a,b,c,d,e){"use strict";{var f,g="undefined"!=typeof e?e:this.dataTheme,h=$("#"+a),i='<fieldset data-role="controlgroup">';this.OGDSM}for(i+='<select name="'+b+'" id="'+c+'" data-theme='+g+">",i+='<option value="">  </option>',f=0;f<d.length;f+=1)i+='<option value="'+d[f]+'">'+d[f]+"</option>";return i+="</select>",i+="</fieldset>",h.append(i),h.trigger("create"),$("#"+c)};

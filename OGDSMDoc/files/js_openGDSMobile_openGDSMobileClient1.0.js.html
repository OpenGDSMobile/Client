<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>js/openGDSMobile/openGDSMobileClient1.0.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title"></h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for:
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>

                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>

                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/OGDSM.html">OGDSM</a></li>
                                <li><a href="../classes/OGDSM.eGovFramUI.html">OGDSM.eGovFramUI</a></li>
                                <li><a href="../classes/OGDSM.externalConnection.html">OGDSM.externalConnection</a></li>
                                <li><a href="../classes/OGDSM.olMap.html">OGDSM.olMap</a></li>
                                <li><a href="../classes/OGDSM.visualization.html">OGDSM.visualization</a></li>
                            </ul>

                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/OGDSM.namespace.html">OGDSM.namespace</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>

                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>

                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>

                </div>

            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/openGDSMobile/openGDSMobileClient1.0.js</h1>

                        <div class="file">
                            <pre class="code prettyprint linenums">
                        //var serverURL = &quot;http://113.198.80.60/&quot;;
                        //var serverFolder = &quot;OpenGDSMobileApplicationServer1.0/&quot;;
                        var serverURL = &quot;http://113.198.80.60:8081/&quot;;
                        var serverFolder = &quot;mobile/&quot;;
                        var geoServerURL = &quot;http://113.198.80.9/&quot;;
                        var vWorldKey = &quot;9E21E5EE-67D4-36B9-85BB-E153321EEE65&quot;;
                        var publicDatakey = &quot;kCxEhXiTf1qmDBlQFOOmw+emcPSxQXn5V5/x8EthoHdbSojIdQvwX+HtWFyuJaIco0nUJtu12e/9acb7HeRRRA==&quot;;
                        var seoulAreaEnvkey = &quot;6473565a72696e7438326262524174&quot;;
                        var seoulRoadEnvkey = &quot;4b56506967696e7437317348694371&quot;;

                        Config = {};
                        Config.map = {};
                        Config.map.init = {
                        		center:[0,0],
                        		zoom: 10
                        };
                        Config.map.projection = ol.proj.get(&#x27;EPSG:900913&#x27;);
                        Config.map.viewOptions = {
                        	projection: Config.map.projection,
                        	center: Config.map.init.center,
                        	zoom: Config.map.init.zoom
                        };

                        Config.map.minScaleDenom = {
                        	map: 1000, // if topic.minscale is not set
                        	geolocation: 10000, // on location following
                        	search: 10000 // jump to search results
                        };

                        //limit min zoom to this scale on the initial geolocation update (null to disable)
                        Config.map.initialGeolocationMaxScale = null;

                        var styleCache = {};
                        var Map = {};
                        	Map.map = null;
                        	Map.addMap = {};
                        	Map.minResolution = null;
                        	Map.layers = {};

                        	Map.deviceOrientation = null;
                        	Map.windowOrientation = undefined;
                        	Map.geolocation = null;
                        /**
                         * Create Base Map based on OL3
                         * parameter : div-&gt; Map div Name , mapStyle -&gt; map style(new ol.source.*)
                         */
                        Map.createBaseMap = function(div,mapStyle){
                        	if(Map.map==null){
                        		Map.layers.baselayer = new ol.layer.Tile({
                        								title: &#x27;basemap&#x27;,
                        								source: mapStyle
                        								});
                        		Map.map = new ol.Map({
                        			layers:[Map.layers.baselayer],
                        			target: div,
                        			view : new ol.View(Config.map.viewOptions)
                        		});
                        		Map.map.getView().on(&#x27;change:rotation&#x27;,function(){
                        			$.event.trigger({type:&#x27;maprotation&#x27;,rotation:Map.map.getView().getRotation()});
                        		});
                        		Map.map.getView().on(&#x27;change:resolution&#x27;,function(){
                        			if(Map.map.getView().getResolution() &lt; Map.minResolution){
                        				Map.map.getView().setResolution(Map.minResolution);
                        			}
                        		});
                        	}else{
                        		Map.map.removeLayer(Map.layers.baselayer);
                        		Map.map.addLayer(Map.layers.baselayer=new ol.layer.Tile({
                        			title:&#x27;basemap&#x27;,
                        			source : mapStyle
                        		}));
                        	}
                        };

                        Map.adjustedHeading = function(heading) {
                        	if (Map.windowOrientation != undefined) {
                        		// include window orientation (0, 90, -90 or 180)
                        		heading -= Map.windowOrientation * Math.PI / 180.0;
                        	}
                        	return heading;
                        };

                        Map.setRotation = function(rotation) {
                        	Map.map.getView().setRotation(rotation);
                        };

                        Map.setWindowOrientation = function(orientation) {
                        	Map.windowOrientation = orientation;
                        	if (Map.deviceOrientation != null &amp;&amp; Map.deviceOrientation.getTracking() &amp;&amp; Map.deviceOrientation.getHeading() != undefined) {
                        		Map.setRotation(Map.adjustedHeading(-Map.deviceOrientation.getHeading()));
                        	}
                        };
                        //adjust max zoom
                        Map.clampToScale = function(scaleDenom) {
                        	var minRes = Map.scaleDenomToResolution(scaleDenom, true);
                        	if (Map.map.getView().getResolution() &lt; minRes) {
                        		Map.map.getView().setResolution(minRes);
                        	}
                        };

                        Map.scaleDenomToResolution = function(scaleDenom, closest) {
                        	// resolution = scaleDenom / (metersPerUnit * dotsPerMeter)
                        	var res = scaleDenom / (Map.map.getView().getProjection().getMetersPerUnit() * (Config.map.dpi / 0.0254));
                        	if (closest) {
                        	  return Map.map.getView().constrainResolution(res);
                        	}
                        	else {
                        	  return res;
                        	}
                        };
                        /**
                         * GeoLocation
                         */
                        Map.centerOnLocation = function(){
                        	Map.geolocation = new ol.Geolocation({
                        		projection:	Map.map.getView().getProjection(),
                        		tracking : true
                        	});
                        };

                        var Gui = {};

                        Gui.initialLoad = true;
                        Gui.selectedLayer = null;
                        Gui.tracking = true;

                        Gui.updateLayout = function(){
                        	var footer = $(&quot;div[data-role=&#x27;footer&#x27;]:visible&quot;),
                        	header = $(&quot;div[data-role=&#x27;header&#x27;]:visible&quot;),
                            content = $(&quot;div[data-role=&#x27;content&#x27;]:visible:visible&quot;),
                            viewHeight = $(window).height(),
                            contentHeight = viewHeight - (footer.outerHeight()+header.outerHeight() );
                        	if ((content.outerHeight() + footer.outerHeight()) !== viewHeight) {
                        	    contentHeight -= (content.outerHeight() - content.height() + 1);
                        	    content.height(contentHeight);
                        	}
                            $(&quot;#map&quot;).width( $(window).width() );
                            $(&quot;#map&quot;).height( contentHeight   );

                        };

                        //Default Projection : EPSG:900913
                        Gui.initViewer = function(){
                        	Gui.updateLayout();
                        	$(window).on(&#x27;resize&#x27;,function(){
                        		Gui.updateLayout();
                        	});
                        	$(window).on(&#x27;orientationchange&#x27;, function(e) {
                        	    Map.setWindowOrientation(window.orientation);
                        	});
                        	/**
                        	 * Vworld Projection
                        	 */
                        	var projection = new ol.proj.Projection({
                        		code: &#x27;EPSG:900913&#x27;,
                        		extent: [-20037508.34, -20037508.34, 20037508.34, 20037508.34],
                        		units : &#x27;m&#x27;
                        	});
                        	ol.proj.addProjection(projection);
                        	/**
                        	 * parameter
                        	 */
                        	openGDSM.baseMap(&#x27;map&#x27;,&#x27;osm&#x27;);
                        	Map.centerOnLocation();
                        	/**
                        	 * Geolocation Event(Set Center)
                        	 **/
                        	Map.geolocation.once(&#x27;change:position&#x27;,function(){
                        		Map.map.getView().setCenter(Map.geolocation.getPosition());
                        	});
                        	/**
                        	 * Layers Event
                        	 **/
                        	$(Map.map.getViewport()).bind(&#x27;tap&#x27;,function(evt){
                        		var pixel = Map.map.getEventPixel(evt.originalEvent);
                        	//	Layer.displayFeatureInfo(pixel);
                        	});
                        	Gui.updateLayout();
                        };

                        $(document).ready(function(e){
                        	Gui.initViewer();
                        });

                        /*
                         * OpenGDS Mobile JavaScript Library
                         * Released under the MIT license
                         */
                        var openGDSM = {};
                        	openGDSM.wmsMapUI = {};
                        	openGDSM.wfsMap ={};
                        var date = {};
                        var cur_date = new Date();
                        (function(){
                        	openGDSM.init = function(){
                        		$(document).on(&quot;pageinit&quot;,function(){
                        			$.mobile.loader.prototype.options.text=&quot;loading&quot;;
                        			$.mobile.loader.prototype.options.textVisible=false;
                        			$.mobile.loader.prototype.options.theme=&quot;a&quot;;
                        			$.mobile.loader.prototype.options.html=&quot;&quot;;
                        		});

                        	};
                        	/**
                        	 * base Map Setting
                        	 * Parameter : divName -&gt; Map div Name,     mapStyle -&gt; osm , vworld
                        	 */
                        	openGDSM.baseMap = function(divName, mapStyle){
                        		var mapType=null;
                        		if(mapStyle ==&#x27;osm&#x27;){
                        			mapType = new ol.source.OSM();
                        		}
                        		else if(mapStyle==&#x27;vworld&#x27;){
                        			mapType = openGDSM.vWorld.TMS();
                        		}
                        		//OpenLayers 3
                        		Map.createBaseMap(divName, mapType);
                        	};
                        	/**  // F65FC751-4918-3760-9218-318D5E3577E0   //60
                        	 * Vworld WMS API User Interface
                        	 * Parameter : divName -&gt; UI div Name, apiKey-&gt;Vworld APIKey
                        	 */
                        	openGDSM.wmsMapUI.vworld = function(divName, apiKey){
                        		makeData = function(apiKey, chkName){
                        			var selectedData = &quot;&quot;;
                        			var vworldChk = $(&quot;input[name=&#x27;vworldWMS&#x27;]:checkbox&quot;);
                        			vworldChk.each(function(i){
                        				if($(this).is(&quot;:checked&quot;)){
                        					selectedData+=$(this).attr(&quot;value&quot;);
                        					selectedData+=&quot;,&quot;;
                        				}
                        			});
                        			selectedData = selectedData.slice(0,-1);

                        			openGDSM.vWorld.wmsAPI(Map.map, apiKey, selectedData);
                        		};
                        		apiKey = vWorldKey;
                        		var rootDiv = $(&#x27;#&#x27;+divName);
                        		var html = &#x27;Select Max 5&lt;br&gt;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        		var styles = [&#x27;LT_C_UQ111&#x27;,&#x27;LT_C_UQ112&#x27;,&#x27;LT_C_UQ113&#x27;,&#x27;LT_C_UQ114&#x27;,
                        		              &#x27;LT_C_UQ121&#x27;,&#x27;LT_C_UQ122&#x27;,&#x27;LT_C_UQ123&#x27;,&#x27;LT_C_UQ124&#x27;,
                        		              &#x27;LT_C_UQ125&#x27;,&#x27;LT_C_UQ126&#x27;,&#x27;LT_C_UQ127&#x27;,&#x27;LT_C_UQ128&#x27;,
                        		              &#x27;LT_C_UQ129&#x27;,&#x27;LT_C_UQ130&#x27;,&#x27;LT_C_WKMBBSN&#x27;,&#x27;LT_C_TDWAREA&#x27;,&#x27;LT_L_FRSTCLIMB&#x27;];
                        		var stylesText = [&#x27;도시지역&#x27;,&#x27;관리지역&#x27;,&#x27;농립지역&#x27;,&#x27;자연환경보전지역&#x27;,&#x27;경관지구&#x27;,&#x27;미관지구&#x27;,
                        		                  	  &#x27;고도지구&#x27;,&#x27;방화지구&#x27;,&#x27;방재지구&#x27;,&#x27;보존지구&#x27;,&#x27;시설보호지구&#x27;,&#x27;취락지구&#x27;,
                        		                  	  &#x27;개발진흥지구&#x27;,&#x27;특정용도제한지구&#x27;,&#x27;수자원[대권역]&#x27;,&#x27;보행우선구역&#x27;,&#x27;등산로&#x27;];

                        		for(var i=0; i&lt;styles.length; i++){
                        			html += &#x27;&lt;input type=&quot;checkbox&quot; name=&quot;vworldWMS&quot; class=&quot;custom&quot; &#x27;+
                        					&#x27; id=&quot;id-&#x27;+styles[i]+&#x27;&quot; value=&quot;&#x27;+styles[i]+&#x27;&quot; /&gt;&#x27;+
                        					&#x27;&lt;label for=&quot;id-&#x27;+styles[i]+&#x27;&quot;&gt;&#x27;+stylesText[i]+&#x27;&lt;/label&gt;&#x27;;
                        			if(i!=0 &amp;&amp; (i+1)%2==0){
                        				html+=&#x27;&lt;/fieldset&gt;&#x27;+
                        					  &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        			}
                        		}
                        		html += &#x27;&lt;/fieldset&gt;&#x27;+
                        		        &#x27;&lt;a href=&quot;#&quot; id=wmsButton data-role=&quot;button&quot; &#x27;+
                        		        &#x27;onclick=makeData(&quot;&#x27;+apiKey+&#x27;&quot;,&quot;vworldWMS&quot;)&gt;지도 추가&lt;/a&gt;&#x27;;
                        		rootDiv.html(html);
                        		rootDiv.trigger(&quot;create&quot;);
                        	};
                        	/**
                        	 * geoServer WFS value Setting
                        	 * parameter : url, workspace, layername, color, width
                        	 */
                        	//openGDSM.wfsMap.geoserver = function(url,workspace,layerName,color,width){
                        	openGDSM.wfsMap.geoserver = function(layerName){
                        		var url = geoServerURL,
                        			workspace = &#x27;opengds&#x27;,
                        			//layerName = &#x27;Seoul_si&#x27;,
                        			r = Math.floor(Math.random()*256),
                        			g = Math.floor(Math.random()*256),
                        			b = Math.floor(Math.random()*256),
                        			color =&#x27;rgba(&#x27;+r+&#x27;,&#x27;+g+&#x27;,&#x27;+b+&#x27;,0.7)&#x27;,
                        			width = 1;
                        		openGDSMGeoserver.wfs(Map.map, url, workspace, layerName, color, width);
                        	};

                        	/**
                        	 * Pulbic OpenData User Interface
                        	 */
                        	openGDSM.PublicDataUI = {
                        			 visualTypeRadioBtn : function(rootDiv, mapSW){
                        				mapSW = (typeof(mapSW) !== &#x27;undefined&#x27;) ? mapSW : true;
                        				var html = &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        				var arr = [&#x27;map&#x27;,&#x27;chart&#x27;,&#x27;chartMap&#x27;];
                        				var arrText = [&#x27;맵&#x27;,&#x27;차트&#x27;,&#x27;맵&amp;차트&#x27;];
                        				for(var i=0; i&lt;arr.length; i++){
                        						html += &#x27;&lt;input type=&quot;radio&quot; name=&quot;visradio&quot; class=&quot;custom&quot; &#x27;+
                        								&#x27; id=&quot;id-&#x27;+arr[i]+&#x27;&quot; value=&quot;&#x27;+arr[i]+&#x27;&quot; &#x27;;//+\
                        						if(mapSW==false &amp;&amp; arr[i]!=&#x27;chart&#x27;) html+=&#x27;disabled &#x27;;
                        						if(i==0) html+= &#x27;checked&#x27;;
                        						html += &#x27; onclick=&quot;openGDSM.PublicDataUI.mapSelect($(this))&quot;/&gt;&#x27;+
                        								&#x27;&lt;label for=&quot;id-&#x27;+arr[i]+&#x27;&quot;&gt;&#x27;+arrText[i]+&#x27;&lt;/label&gt;&#x27;;
                        				}
                        				html += &#x27;&lt;/fieldset&gt;&#x27;;		rootDiv.append(html);
                        				rootDiv.append(&#x27;&lt;div id=&quot;wfsMap&quot;&gt;&lt;/div&gt;&#x27;);
                        			 },
                        			 inputDate : function(rootDiv){
                        				var html =  &#x27;&lt;label for=&quot;dateValue&quot;&gt;날짜 : &lt;/label&gt;&#x27;+
                        							&#x27;&lt;input type=&quot;date&quot; id=&quot;dateValue&quot;/&gt;&#x27;;
                        				rootDiv.append(html);
                        				this.dateChk = true;
                        			 },
                        			 inputTime : function(rootDiv){
                        					var html =  &#x27;&lt;label for=&quot;timeValue&quot;&gt;시간 : &lt;/label&gt;&#x27;+
                        								 &#x27;&lt;input type=&quot;time&quot; id=&quot;timeValue&quot;&gt;&#x27;;
                        					rootDiv.append(html);
                        					this.timeChk = true;
                        				 },
                        			 inputValueSetting : function(){
                        				if(this.dateChk) $(&quot;#dateValue&quot;).attr(&#x27;value&#x27;,date.getYYYYMMDD(&quot;-&quot;));
                        				if(this.timeChk) $(&quot;#timeValue&quot;).attr(&#x27;value&#x27;,date.getHour()+&quot;:00&quot;);
                        			 },
                        			 processBtn : function(rootDiv,obj,serviceName, provider){
                        				 console.log(obj);
                        				 provider = (typeof(provider) !== &#x27;undefined&#x27;) ? provider : &quot;&quot;;
                        					var html = &#x27;&lt;a href=&quot;#&quot; data-role=&quot;button&quot; data-provider=&quot;&#x27;+provider+&#x27;&quot; data-serivce=&quot;&#x27;+serviceName+&#x27;&quot; &#x27;+
                        					 			&#x27;onclick=&quot;openGDSM.&#x27;+obj+&#x27;.makeData($(this))&quot;&gt;시각화&lt;/a&gt;&#x27;;
                        					rootDiv.append(html);
                        			 },
                        			 mapSelect : function(obj){
                        				 var mapSelect = $(&#x27;#wfsMap&#x27;);
                        				 if(mapSelect.is(&#x27;:empty&#x27;)){
                        					 if(obj.val()==&#x27;map&#x27; || obj.val()==&#x27;chartMap&#x27;){
                        						 var html = &#x27;&lt;div data-role=&quot;fieldcontain&quot;&gt;&#x27;+
                        						 			&#x27;&lt;select name=&quot;geoServerMap&quot; id=&quot;geoserverSelectBox&quot;&gt;&#x27;;
                        						 for(var i=0; i&lt;openGDSMGeoserver.mapLayers.length; i++){
                        							 html += &#x27;&lt;option value=&quot;&#x27;+openGDSMGeoserver.mapLayers[i]+&#x27;&quot;&#x27;;
                        							 if(i==0) html+=&#x27; selected&#x27;;
                        							 html += &#x27;&gt;&#x27;+openGDSMGeoserver.mapLayers[i]+&#x27;&lt;/option&gt;&#x27;;
                        						 }
                        						 html +=&#x27;&lt;/select&gt;&#x27;;
                        						 mapSelect.append(html);
                        						 mapSelect.trigger(&quot;create&quot;);
                        					 }
                        				 }
                        				 //Only Chart
                        				 else{
                        					if(obj.val()==&#x27;chart&#x27;){
                        						mapSelect.empty();
                        					}
                        				 }
                        			 },
                        	};
                        	/**
                        	 * Seoul Pulbic OpenData Interface
                        	 */
                        	//TimeAverageAirQuality
                        	 openGDSM.seoulPublic = {
                        			 divName : &#x27;&#x27;,
                        			 apiKey : &#x27;&#x27;,
                        			 dateChk : false,
                        			 timeChk : false,
                        			 makeData : function(obj){
                        				var visType=&quot;&quot;, envType=&quot;&quot;;
                        				var visRadio = $(&quot;input[name=&#x27;visradio&#x27;]:radio&quot;);
                        				var envRadio = $(&quot;input[name=&#x27;envradio&#x27;]:radio&quot;);
                        				visRadio.each(function(i){
                        					if($(this).is(&quot;:checked&quot;)){
                        						visType=$(this).val();
                        					}
                        				});
                        				envRadio.each(function(i){
                        					if($(this).is(&quot;:checked&quot;)){
                        						envType=$(this).val();
                        					}
                        				});
                        				$(&#x27;#&#x27;+this.divName).popup(&quot;close&quot;);
                        				openGDSM.seoulOpenData.env.dataLoad(
                        						obj.attr(&quot;data-serivce&quot;),
                        						this.apiKey, visType, envType,
                        						$(&quot;select[name=geoServerMap]&quot;).val(),
                        						$(&quot;#dateValue&quot;).val(),
                        						$(&quot;#timeValue&quot;).val());
                        			 },
                        			 /// TimeAverageAirQuality Service...
                        			 areaEnv : function(divName, apiKey){
                        				$(&#x27;#&#x27;+divName).empty();
                        				this.divName = divName;
                        				this.dateChk = true, this.timeChk = true;
                        				this.apiKey = seoulAreaEnvkey;
                        				var rootDiv = $(&#x27;#&#x27;+divName);
                        				openGDSM.PublicDataUI.visualTypeRadioBtn(rootDiv);
                        				openGDSM.PublicDataUI.inputDate(rootDiv);
                        				openGDSM.PublicDataUI.inputTime(rootDiv);

                        				var html = &#x27;&lt;label for=&quot;envValue&quot;&gt;환경정보:&lt;/label&gt;&#x27;+
                        						   &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        				var envType = [&#x27;pm10&#x27;,&#x27;pm25&#x27;,&#x27;so2&#x27;,&#x27;o3&#x27;,&#x27;no2&#x27;,&#x27;co&#x27;];
                        				var envTypeValue = [&#x27;PM10&#x27;,&#x27;PM25&#x27;,&#x27;SO2&#x27;,&#x27;O3&#x27;,&#x27;NO2&#x27;,&#x27;CO&#x27;];
                        				for(var i=0; i&lt;envType.length; i++){
                        					html += &#x27;&lt;input type=&quot;radio&quot; name=&quot;envradio&quot; class=&quot;custom&quot; &#x27;+
                        					&#x27; id=&quot;id-&#x27;+envTypeValue[i]+&#x27;&quot; value=&quot;&#x27;+envTypeValue[i]+&#x27;&quot;/&gt;&#x27;+
                        					&#x27;&lt;label for=&quot;id-&#x27;+envTypeValue[i]+&#x27;&quot;&gt;&#x27;+
                        					//envType[i]+
                        					&#x27;&lt;img src=&quot;images/&#x27;+envType[i]+&#x27;.png&quot; width=30&gt;&#x27;+
                        					&#x27;&lt;/label&gt;&#x27;;
                        					if(i!=0 &amp;&amp; (i+1)%3==0){
                        						html+=&#x27;&lt;/fieldset&gt;&#x27;+
                        							  &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        					}
                        				}
                        				html += &#x27;&lt;/fieldset&gt;&#x27;;
                        				rootDiv.append(html);
                        				openGDSM.PublicDataUI.processBtn(rootDiv,&#x27;seoulPublic&#x27;, &quot;TimeAverageAirQuality&quot;);
                        				rootDiv.trigger(&quot;create&quot;);
                        				openGDSM.PublicDataUI.inputValueSetting();
                        			 },
                        			 //RealtimeRoadsideStation Service
                        			 roadEnv : function(divName, apiKey){
                        					$(&#x27;#&#x27;+divName).empty();
                        					this.divName = divName;
                        					this.dateChk = false, this.timeChk = false;
                        					this.apiKey = seoulRoadEnvkey;
                        				 	var rootDiv = $(&#x27;#&#x27;+this.divName);
                        				 	openGDSM.PublicDataUI.visualTypeRadioBtn(rootDiv,false);

                        					var html = &#x27;&lt;label for=&quot;envValue&quot;&gt;환경정보:&lt;/label&gt;&#x27;+
                        							   &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;

                        					var envType = [&#x27;pm10&#x27;,&#x27;pm25&#x27;,&#x27;so2&#x27;,&#x27;o3&#x27;,&#x27;no2&#x27;,&#x27;co&#x27;];
                        					var envTypeValue = [&#x27;PM10&#x27;,&#x27;PM25&#x27;,&#x27;SO2&#x27;,&#x27;O3&#x27;,&#x27;NO2&#x27;,&#x27;CO&#x27;];
                        					for(var i=0; i&lt;envType.length; i++){
                        						html += &#x27;&lt;input type=&quot;radio&quot; name=&quot;envradio&quot; class=&quot;custom&quot; &#x27;+
                        						&#x27; id=&quot;id-&#x27;+envTypeValue[i]+&#x27;&quot; value=&quot;&#x27;+envTypeValue[i]+&#x27;&quot;/&gt;&#x27;+
                        						&#x27;&lt;label for=&quot;id-&#x27;+envTypeValue[i]+&#x27;&quot;&gt;&#x27;+
                        						//envType[i]+
                        						&#x27;&lt;img src=&quot;images/&#x27;+envType[i]+&#x27;.png&quot; width=30&gt;&#x27;+
                        						&#x27;&lt;/label&gt;&#x27;;
                        						if(i!=0 &amp;&amp; (i+1)%3==0){
                        							html+=&#x27;&lt;/fieldset&gt;&#x27;+
                        								  &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        						}
                        					}
                        					html += &#x27;&lt;/fieldset&gt;&#x27;;
                        					rootDiv.append(html);
                        					openGDSM.PublicDataUI.processBtn(rootDiv,&#x27;seoulPublic&#x27;, &quot;RealtimeRoadsideStation&quot;);
                        					rootDiv.trigger(&quot;create&quot;);
                        					openGDSM.PublicDataUI.inputValueSetting();
                        			 }
                        	 };

                        	 openGDSM.PublicDataPortal = {
                        			 apiKey : &#x27;&#x27;,
                        			 visualTypeRadioBtn : function(rootDiv, mapSW){
                        					mapSW = (typeof(mapSW) !== &#x27;undefined&#x27;) ? mapSW : true;
                        					var html = &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        					var arr = [&#x27;map&#x27;,&#x27;chart&#x27;,&#x27;chartMap&#x27;];
                        					var arrText = [&#x27;맵&#x27;,&#x27;차트&#x27;,&#x27;맵&amp;차트&#x27;];
                        					for(var i=0; i&lt;arr.length; i++){
                        							html += &#x27;&lt;input type=&quot;radio&quot; name=&quot;visradio&quot; class=&quot;custom&quot; &#x27;+
                        									&#x27; id=&quot;id-&#x27;+arr[i]+&#x27;&quot; value=&quot;&#x27;+arr[i]+&#x27;&quot; &#x27;;//+
                        							if(mapSW==false) html+=&#x27;disabled &#x27;;
                        							if(i==0) html+= &#x27;checked&#x27;;
                        							html += &#x27; onclick=&quot;openGDSM.PublicDataPortalUI.mapSelect($(this))&quot;/&gt;&#x27;+
                        									&#x27;&lt;label for=&quot;id-&#x27;+arr[i]+&#x27;&quot;&gt;&#x27;+arrText[i]+&#x27;&lt;/label&gt;&#x27;;
                        					}
                        					html += &#x27;&lt;/fieldset&gt;&#x27;;		rootDiv.append(html);
                        					rootDiv.append(&#x27;&lt;div id=&quot;wfsMap&quot;&gt;&lt;/div&gt;&#x27;);
                        			},
                        			 makeData : function(obj){
                        				var visType=&quot;&quot;, envType=&quot;&quot;, areaType=&quot;&quot;;
                        				var visRadio = $(&quot;input[name=&#x27;visradio&#x27;]:radio&quot;);
                        				var envRadio = $(&quot;input[name=&#x27;envradio&#x27;]:radio&quot;);
                        				var areaRadio = $(&quot;input[name=&#x27;arearadio&#x27;]:radio&quot;);
                        				visRadio.each(function(i){
                        					if($(this).is(&quot;:checked&quot;)){
                        						visType=$(this).val();
                        					}
                        				});
                        				envRadio.each(function(i){
                        					if($(this).is(&quot;:checked&quot;)){
                        						envType=$(this).val();
                        					}
                        				});
                        				areaRadio.each(function(i){
                        					if($(this).is(&quot;:checked&quot;)){
                        						areaType=$(this).val();
                        					}
                        				});
                        				$(&#x27;#&#x27;+this.divName).popup(&quot;close&quot;);
                        				openGDSM.publicOpenData.env.dataLoad(
                        						obj.attr(&quot;data-provider&quot;),
                        						obj.attr(&quot;data-serivce&quot;),
                        						this.apiKey, visType, envType, areaType,
                        						$(&quot;select[name=geoServerMap]&quot;).val()
                        						);
                        			 },
                        			 areaEnv : function(divName, apiKey){
                        				this.apiKey = encodeURIComponent(apiKey);
                        				$(&#x27;#&#x27;+divName).empty();
                        				this.divName = divName;
                        			 	var rootDiv = $(&#x27;#&#x27;+this.divName);
                        			 	openGDSM.PublicDataUI.visualTypeRadioBtn(rootDiv);

                        			 	var html = &#x27;&lt;label for=&quot;areaValue&quot;&gt;지역:&lt;/label&gt;&#x27;+
                        				   &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        			 	var areaType=[&#x27;서울&#x27;,&#x27;부산&#x27;,&#x27;대구&#x27;,&#x27;대전&#x27;,&#x27;광주&#x27;,&#x27;울산&#x27;,&#x27;인천&#x27;,&#x27;전남&#x27;,&#x27;전북&#x27;,&#x27;경남&#x27;,&#x27;경북&#x27;,&#x27;강원&#x27;,&#x27;경기&#x27;,&#x27;제주&#x27;] ;
                        			 	var areaValues=[&#x27;서울&#x27;,&#x27;부산&#x27;,&#x27;대구&#x27;,&#x27;대전&#x27;,&#x27;광주&#x27;,&#x27;울산&#x27;,&#x27;인천&#x27;,&#x27;전남&#x27;,&#x27;전북&#x27;,&#x27;경남&#x27;,&#x27;경북&#x27;,&#x27;강원&#x27;,&#x27;경기&#x27;,&#x27;제주&#x27;] ;
                        			 	for(var i=0; i&lt;areaType.length; i++){
                        			 		html += &#x27;&lt;input type=&quot;radio&quot; name=&quot;arearadio&quot; class=&quot;custom&quot; &#x27;+
                        			 				&#x27; id=&quot;id-&#x27;+areaType[i]+&#x27;&quot; value=&quot;&#x27;+areaValues[i]+&#x27;&quot;/&gt;&#x27;+
                        			 				&#x27;&lt;label for=&quot;id-&#x27;+areaType[i]+&#x27;&quot;&gt;&#x27;+areaType[i]+&#x27;&lt;/label&gt;&#x27;;
                        			 		if(i!=0 &amp;&amp; (i+1)%3==0){
                        			 				html+=&#x27;&lt;/fieldset&gt;&#x27;+
                        			 				&#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        			 		}
                        			 	}
                        			 	html += &#x27;&lt;/fieldset&gt;&#x27;;

                        			 	html += &#x27;&lt;label for=&quot;envValue&quot;&gt;환경정보:&lt;/label&gt;&#x27;+
                        				   &#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        			 	var envType = [&#x27;pm10&#x27;,&#x27;pm25&#x27;,&#x27;so2&#x27;,&#x27;o3&#x27;,&#x27;no2&#x27;,&#x27;co&#x27;];
                        			 	var envValues = [&#x27;pm10Value&#x27;,&#x27;so2Value&#x27;,&#x27;o3Value&#x27;,&#x27;no2Value&#x27;,&#x27;coValue&#x27;];
                        			 	for(var i=0; i&lt;envType.length; i++){
                        			 		html += &#x27;&lt;input type=&quot;radio&quot; name=&quot;envradio&quot; class=&quot;custom&quot; &#x27;+
                        			 				&#x27; id=&quot;id-&#x27;+envType[i]+&#x27;&quot; value=&quot;&#x27;+envValues[i]+&#x27;&quot;/&gt;&#x27;+
                        			 				&#x27;&lt;label for=&quot;id-&#x27;+envType[i]+&#x27;&quot;&gt;&#x27;+
                        							//envType[i]+
                        							&#x27;&lt;img src=&quot;images/&#x27;+envType[i]+&#x27;.png&quot; width=30&gt;&#x27;+
                        			 				&#x27;&lt;/label&gt;&#x27;;
                        			 		if(i!=0 &amp;&amp; (i+1)%3==0){
                        			 				html+=&#x27;&lt;/fieldset&gt;&#x27;+
                        			 				&#x27;&lt;fieldset data-role=&quot;controlgroup&quot; data-type=&quot;horizontal&quot; class=&quot;egov-align-center&quot;&gt;&#x27;;
                        			 		}
                        			 	}
                        			 	html += &#x27;&lt;/fieldset&gt;&#x27;;
                        				rootDiv.append(html);

                        				openGDSM.PublicDataUI.processBtn(rootDiv,&quot;PublicDataPortal&quot;,&quot;ArpltnInforInqireSvc&quot;, &quot;airkorea&quot;);
                        			 	rootDiv.trigger(&quot;create&quot;);
                        			 }
                        	 };





                        	 //////////////////////////////////////////
                        	createkeyValueJsonString = function(data){
                        		var str = &quot;{&quot;;
                        		for(var i in data){
                        			str= str + &#x27;&quot;&#x27;+data[i].attr(&#x27;data-key&#x27;)+&#x27;&quot;:&#x27;;
                        			str= str + &#x27;&quot;&#x27;+data[i].attr(&#x27;data-value&#x27;);
                        			if((data.length-1)==i)	str +=&#x27;&quot;}&#x27;;
                        			else						str +=&#x27;&quot;,&#x27;;
                        		}
                        		return JSON.parse(str);
                        	};//JSON {key:value}

                        /**
                         * getDate Module About Public Date
                         */
                        	date.getYear = function(){	return cur_date.getFullYear();	};
                        	date.getDate = function(){	return cur_date.getDate();		};
                        	date.getMonth= function(){	return cur_date.getMonth();		};
                        	date.getHour = function(){
                        		var hours;
                        		var minute = cur_date.getMinutes();
                        			if(minute &lt; 30){
                        				if(cur_date.getHours()==0){
                        					hours = leadingZeros(cur_date.getHours()+23,2);
                        				}else	hours = leadingZeros(cur_date.getHours()-1,2);
                        			}else{
                        				hours = leadingZeros(cur_date.getHours(),2);
                        			}
                        		return hours;
                        	};// 30 minute cut line  (30 up) +1
                        	date.getMin = function(){	return cur_date.getMinutes();	};
                        	date.getYYYYMMDDHH = function(){
                        		var year = cur_date.getFullYear();
                        		var month = leadingZeros(cur_date.getMonth()+1,2);
                        		var date = leadingZeros(cur_date.getDate(),2);
                        		var minute = cur_date.getMinutes();
                        		var hours;
                        			if(minute &lt; 30){
                        				if(cur_date.getHours()==0){
                        					date = leadingZeros(cur_date.getDate()-1,2);
                        					hours = 23;
                        				}else	hours = leadingZeros(cur_date.getHours()-1,2);
                        			}else{
                        				hours = leadingZeros(cur_date.getHours(),2);
                        			}
                        			minute = &quot;00&quot;;
                        		return year+month+date+hours+minute;
                        	};
                        	date.getYYYYMMDD = function(plug){
                        		var year = cur_date.getFullYear();
                        		var month = leadingZeros(cur_date.getMonth()+1,2);
                        		var date = leadingZeros(cur_date.getDate(),2);
                        		if(plug==null)
                        			return year+month+date;
                        		else
                        			return year+plug+month+plug+date;
                        	};

                        	leadingZeros = function(n,digits){
                        		var zero = &#x27;&#x27;;
                        		n = n.toString();
                        		if (n.length &lt; digits) {
                        			for (var i = 0; i &lt; digits - n.length; i++)
                        				zero += &#x27;0&#x27;;
                        		}
                        	  return zero + n;
                        	};
                        })();

                        openGDSM.vWorld ={
                        		TMS:function(){
                        			return new ol.source.XYZ(({
                        				url : &quot;http://xdworld.vworld.kr:8080/2d/Base/201310/{z}/{x}/{y}.png&quot;
                        			}));
                        		},
                        		wmsAPI : function(olMap, apiKey, mapStyles){
                        			var wmslayer = new ol.layer.Tile({
                        				source: new ol.source.TileWMS(({
                        					url: &quot;http://map.vworld.kr/js/wms.do&quot;,
                        					params: {
                        						domain:&#x27;http://localhost&#x27;,
                        	  					apiKey:apiKey,
                        	  					LAYERS:mapStyles,
                        	  					STYLES:mapStyles,
                        	  					FORMAT:&#x27;image/png&#x27;,
                        	  					CRS:&#x27;EPSG:900913&#x27;,
                        	  					EXCEPTIONS:&#x27;text/xml&#x27;,
                        	  					TRANSPARENT:true
                        	  					}
                        	  			}))
                        			});
                        			olMap.addLayer(wmslayer);
                        		}
                        };
                        openGDSM.seoulOpenData = { };
                        var styleCache = {};

                        openGDSM.seoulOpenData.env = {
                        	key : &quot;6473565a72696e7438326262524174&quot;,
                        	serviceName : &#x27;&#x27;,
                        	envType : &#x27;&#x27;,
                        	visType : &#x27;&#x27;,
                        	mapLayer : &#x27;&#x27;,
                        	dateValue : &#x27;&#x27;,
                        	timeValue : &#x27;&#x27;,
                        	colorRange : [&quot;#4C4Cff&quot;,&quot;#9999FF&quot;,&quot;#4cff4c&quot;,&quot;#99ff99&quot;,&quot;#FFFF00&quot;,&quot;#FFFF99&quot;,&quot;#FF9900&quot;,&quot;#FF0000&quot;],
                        	PM10Range : [15,30,55,80,100,120,200],
                        	PM25Range : [15,30,55,80,100,120,200],
                        	CORange : [1,2,5.5,9,10.5,12,15],
                        	NO2Range : [0.015,0.03,0.05,0.06,0.1045,0.15,0.2],
                        	SO2Range : [0.01,0.02,0.035,0.05,0.075,0.1,0.15],
                        	O3Range : [0.02,0.04,0.06,0.08,0.10,0.12,0.3],
                        	dataLoad : function(serviceName,apiKey, visType, envType, mapLayer, dateValue, timeValue){
                        		mapLayer = (typeof(mapLayer) !== &#x27;undefined&#x27;) ? mapLayer : &quot;&quot;;
                        		dateValue = (typeof(dateValue) !== &#x27;undefined&#x27;) ? dateValue : &quot;&quot;;
                        		timeValue = (typeof(timeValue) !== &#x27;undefined&#x27;) ? timeValue : &quot;&quot;;
                        		this.serviceName = serviceName;
                        		this.envType = envType;
                        		this.visType = visType;
                        		this.mapLayer = mapLayer;
                        		this.dateValue = dateValue;
                        		this.timeValue = timeValue;
                        		var data = &#x27;{&quot;serviceName&quot;:&quot;&#x27;+serviceName+&#x27;&quot;,&#x27;+
                        		   			&#x27; &quot;keyValue&quot;:&quot;&#x27;+apiKey+&#x27;&quot;,&#x27;+
                        		   			&#x27;&quot;dateValue&quot;:&#x27;+&#x27;&quot;&#x27;+dateValue+&#x27;&quot;,&#x27;+
                        		   			&#x27;&quot;timeValue&quot;:&#x27;+&#x27;&quot;&#x27;+timeValue+&#x27;&quot;}&#x27;;
                        			data=JSON.parse(data);
                        		$.ajax({
                        			type:&#x27;POST&#x27;,
                        			url:serverURL+serverFolder+&#x27;EnvironmentSeoulData.do&#x27;,
                        			data: JSON.stringify(data),
                        			contentType : &quot;application/json;charset=UTF-8&quot;,
                        			dataType : &#x27;json&#x27;,
                        			success:function(msg){
                        				if(visType==&#x27;chart&#x27;)
                        					openGDSM.seoulOpenData.env.chartVisual(JSON.parse(msg.data));
                        				else if(visType==&#x27;map&#x27;)
                        					openGDSM.seoulOpenData.env.mapVisual(JSON.parse(msg.data));
                        				else if(visType==&#x27;chartMap&#x27;)
                        					openGDSM.seoulOpenData.env.chartMapVisual(JSON.parse(msg.data));
                        			},
                        			error:function(){
                        				console.log(&quot;err&quot;);
                        			}
                        		});
                        	},
                        	chartVisual : function(data){
                        		$(&#x27;#dataSelect&#x27;).popup(&quot;open&quot;);
                        		var envRange=[];
                        		var xyData=this.xydivision(data[this.serviceName], this.envType, &#x27;MSRSTE_NM&#x27;);
                        		if(this.envType==&quot;PM10&quot;)
                        			envRange = this.PM10Range;
                        		else if(this.envType==&quot;PM25&quot;)
                        			envRange = this.PM25Range;
                        		else if(this.envType==&quot;CO&quot;)
                        			envRange = this.CORange;
                        		else if(this.envType==&quot;NO2&quot;)
                        			envRange = this.NO2Range;
                        		else if(this.envType==&quot;SO2&quot;)
                        			envRange = this.SO2Range;
                        		else if(this.envType==&quot;O3&quot;)
                        			envRange = this.O3Range;
                        		openGDSM.d3.barchart(&#x27;d3View&#x27;,xyData,this.colorRange,envRange);
                        	},
                        	/**
                        	 * SeoupOpenData Environment Data OpenLayers Style
                        	 */
                        	mapVisual: function(data){
                        		var envRange=[];
                        		var envMap=null;
                        		var curMaps=null;
                        		var xyData=this.xydivision(data[this.serviceName], this.envType, &#x27;MSRSTE_NM&#x27;);

                        		if(this.envType==&quot;PM10&quot;)
                        			envRange = this.PM10Range;
                        		else if(this.envType==&quot;PM25&quot;)
                        			envRange = this.PM25Range;
                        		else if(this.envType==&quot;CO&quot;)
                        			envRange = this.CORange;
                        		else if(this.envType==&quot;NO2&quot;)
                        			envRange = this.NO2Range;
                        		else if(this.envType==&quot;SO2&quot;)
                        			envRange = this.SO2Range;
                        		else if(this.envType==&quot;O3&quot;)
                        			envRange = this.O3Range;
                        		//WFS addLayer
                        		openGDSMGeoserver.wfs(Map.map, serverURL,&#x27;opengds&#x27;,this.mapLayer);

                        		curMaps = Map.map.getLayers().getArray();
                        		for(var i=0; i&lt;curMaps.length; i++){
                        			if( curMaps[i].get(&#x27;title&#x27;) == this.mapLayer){
                        				envMap = curMaps[i];
                        			}
                        		}
                        		styleCache = {};
                        		envMap.setStyle(function(f,r){
                        			var text = r &lt; 5000 ? f.get(&#x27;SIG_KOR_NM&#x27;) : &#x27;&#x27;;
                        			if(!styleCache[text]){
                        				var color = &#x27;&#x27;;
                        				for(var i=0; i&lt;xyData[1].length; i++){
                        					if(text==xyData[1][i]){
                        						for(var j=0; j&lt;envRange.length; j++){
                        							if( xyData[0][i] &lt;= envRange[j] ){
                        								color = openGDSM.seoulOpenData.env.colorRange[j];
                        								break;
                        							}
                        						}
                        					}
                        				}
                        				styleCache[text] = [new ol.style.Style({
                        					fill : new ol.style.Fill({
                        						color : color
                        					}),
                        					stroke : new ol.style.Stroke({
                        						color : &#x27;#000000&#x27;,
                        						width : 1
                        					}),
                        					text : new ol.style.Text({
                        			          font: &#x27;9px Calibri,sans-serif&#x27;,
                        			          text: text,
                        			          fill: new ol.style.Fill({
                        			            color: &#x27;#000&#x27;
                        			          })
                        					})
                        				})];
                        			}
                        			return styleCache[text];
                        		});
                        		envMap.setOpacity(0.6);
                        		$(&#x27;#interpolationMapImage&#x27;).attr(&#x27;src&#x27;,&#x27;http://113.198.80.60/html/aqm/resultImages/&#x27;+this.dateValue.split(&quot;-&quot;).join(&quot;&quot;)+this.timeValue.replace(&quot;:&quot;,&quot;&quot;)+this.envType+&#x27;_result.jpg&#x27;);
                        		$(&#x27;#interpolationMapImage&#x27;).attr(&#x27;height&#x27;,&#x27;250px&#x27;);
                        		$(&#x27;#interpolationMap&#x27;).show();
                        	},
                        	chartMapVisual: function(data){
                        		$(&#x27;#d3viewonMap&#x27;).show();
                        		var envRange=[];
                        		var xyData=this.xydivision(data[this.serviceName], this.envType, &#x27;MSRSTE_NM&#x27;);
                        		if(this.envType==&quot;PM10&quot;)
                        			envRange = this.PM10Range;
                        		else if(this.envType==&quot;PM25&quot;)
                        			envRange = this.PM25Range;
                        		else if(this.envType==&quot;CO&quot;)
                        			envRange = this.CORange;
                        		else if(this.envType==&quot;NO2&quot;)
                        			envRange = this.NO2Range;
                        		else if(this.envType==&quot;SO2&quot;)
                        			envRange = this.SO2Range;
                        		else if(this.envType==&quot;O3&quot;)
                        			envRange = this.O3Range;
                        		openGDSM.d3.barchart(&#x27;d3viewonMap_sub&#x27;,xyData,this.colorRange,envRange);
                        		this.mapVisual(data);

                        	},
                        	/**
                        	 * SeoupOpenData Environment Data Division xData,yData
                        	 * parameter : JSON data
                        	 * return : 2 dim x axis and y axis   [0]: x Axis, [1] : y Axis
                        	 */
                        	xydivision: function(data, envType, yType){
                        		var xyAxis = new Array();
                        			xyAxis[0] = new Array();
                        			xyAxis[1] = new Array();
                        		var row = data.row;
                        		$.each(row, function(idx){
                        			xyAxis[0].push(row[idx][envType]);
                        			xyAxis[1].push(row[idx][&quot;MSRSTE_NM&quot;]);
                        		});
                        		return xyAxis;
                        	},
                        };

                        openGDSM.publicOpenData = {
                        		urls : {
                        			airkorea : &#x27;http://openapi.airkorea.or.kr/openapi/service/rest/&#x27;
                        		}
                        };

                        openGDSM.publicOpenData.env = {
                        		visType :&#x27;&#x27;,
                        		envType :&#x27;&#x27;,
                        		areaType :&#x27;&#x27;,
                        		mapLayer : &#x27;&#x27;,
                        		colorRange : [&quot;#4C4Cff&quot;,&quot;#9999FF&quot;,&quot;#4cff4c&quot;,&quot;#99ff99&quot;,&quot;#FFFF00&quot;,&quot;#FFFF99&quot;,&quot;#FF9900&quot;,&quot;#FF0000&quot;],
                        		PM10Range : [15,30,55,80,100,120,200],
                        		CORange : [1,2,5.5,9,10.5,12,15],
                        		NO2Range : [0.015,0.03,0.05,0.06,0.1045,0.15,0.2],
                        		SO2Range : [0.01,0.02,0.035,0.05,0.075,0.1,0.15],
                        		O3Range : [0.02,0.04,0.06,0.08,0.10,0.12,0.3],
                        		dataLoad : function(provider,serviceName,apiKey,visType,envType,areaType,mapLayer){
                        			mapLayer = (typeof(mapLayer) !== &#x27;undefined&#x27;) ? mapLayer : &quot;&quot;;
                        			//console.log(provider+&#x27; &#x27;+serviceName+&#x27; &#x27;+apiKey+&#x27; &#x27;+visType+&#x27; &#x27;+envType+&#x27; &#x27;+areaType+&#x27; &#x27;+mapLayer);
                        			this.visType = visType;
                        			this.envType = envType;
                        			this.areaType = areaType;
                        			this.mapLayer = mapLayer;
                        			var data = &#x27;{&quot;serviceName&quot;:&quot;&#x27;+serviceName+&#x27;&quot;,&#x27;+
                        			   			&#x27;&quot;keyValue&quot;:&quot;&#x27;+apiKey+&#x27;&quot;,&#x27;+
                        			   			&#x27;&quot;areaType&quot;:&quot;&#x27;+encodeURIComponent(areaType)+&#x27;&quot;,&#x27;+
                        			   			&#x27;&quot;envType&quot;:&quot;&#x27;+envType+&#x27;&quot;,&#x27;+
                        			   			&#x27;&quot;provider&quot;:&#x27;+&#x27;&quot;&#x27;+provider+&#x27;&quot;}&#x27;;
                        				data=JSON.parse(data);
                        		$.ajax({
                        			type:&#x27;POST&#x27;,
                        			url:serverURL+serverFolder+&#x27;EnvironmentPublicData.do&#x27;,
                        			data: JSON.stringify(data),
                        			contentType : &quot;application/json;charset=UTF-8&quot;,
                        			dataType : &#x27;json&#x27;,
                        			success:function(msg){
                        				if(visType==&#x27;chart&#x27;)
                        					openGDSM.publicOpenData.env.chartVisual(JSON.parse(msg.data));
                        				else if(visType==&#x27;map&#x27;)
                        					openGDSM.publicOpenData.env.mapVisual(JSON.parse(msg.data));
                        				else if(visType==&#x27;chartMap&#x27;)
                        					openGDSM.publicOpenData.env.chartMapVisual(JSON.parse(msg.data));

                        			},
                        			error:function(){
                        				console.log(&quot;err&quot;);
                        			}
                        		});
                        		},
                        		chartVisual : function(data){
                        			$(&#x27;#dataSelect&#x27;).popup(&quot;open&quot;);
                        			var envRange=[];
                        			var xyData = this.JSONtoArray(data,this.envType,&#x27;stationName&#x27;);
                        			if(this.envType==&quot;pm10Value&quot;)
                        				envRange = this.PM10Range;
                        			else if(this.envType==&quot;coValue&quot;)
                        				envRange = this.CORange;
                        			else if(this.envType==&quot;no2Value&quot;)
                        				envRange = this.NO2Range;
                        			else if(this.envType==&quot;so2Value&quot;)
                        				envRange = this.SO2Range;
                        			else if(this.envType==&quot;o3Value&quot;)
                        				envRange = this.O3Range;
                        			openGDSM.d3.barchart(&#x27;d3View&#x27;,xyData,this.colorRange,envRange);
                        		},
                        		mapVisual: function(data){
                        			var envRange=[];
                        			var envMap=null;
                        			var curMaps=null;
                        			var xyData=this.JSONtoArray(data, this.envType, &#x27;stationName&#x27;);
                        			if(this.envType==&quot;pm10Value&quot;)
                        				envRange = this.PM10Range;
                        			else if(this.envType==&quot;coValue&quot;)
                        				envRange = this.CORange;
                        			else if(this.envType==&quot;no2Value&quot;)
                        				envRange = this.NO2Range;
                        			else if(this.envType==&quot;so2Value&quot;)
                        				envRange = this.SO2Range;
                        			else if(this.envType==&quot;o3Value&quot;)
                        				envRange = this.O3Range;
                        			//WFS addLayer
                        			openGDSMGeoserver.wfs(Map.map, serverURL,&#x27;opengds&#x27;,this.mapLayer);

                        			curMaps = Map.map.getLayers().getArray();
                        			for(var i=0; i&lt;curMaps.length; i++){
                        				if( curMaps[i].get(&#x27;title&#x27;) == this.mapLayer){
                        					envMap = curMaps[i];
                        				}
                        			}
                        			styleCache = {};
                        			envMap.setStyle(function(f,r){
                        				var text ;
                        				if(openGDSM.publicOpenData.env.mapLayer ==&#x27;Seoul_si&#x27;) text =r &lt; 5000 ? f.get(&#x27;SIG_KOR_NM&#x27;) : &#x27;&#x27;;
                        				else text =r &lt; 5000 ? f.get(&#x27;EMD_KOR_NM&#x27;) : &#x27;&#x27;;
                        				if(!styleCache[text]){
                        					var color = &#x27;rgba(255,255,255,0.5)&#x27;;
                        					for(var i=0; i&lt;xyData[1].length; i++){
                        						if(text==xyData[1][i]){
                        							for(var j=0; j&lt;envRange.length; j++){
                        								if( xyData[0][i] &lt;= envRange[j] ){
                        									color = openGDSM.seoulOpenData.env.colorRange[j];
                        									break;
                        								}
                        							}
                        						}
                        					}
                        					styleCache[text] = [new ol.style.Style({
                        						fill : new ol.style.Fill({
                        							color : color
                        						}),
                        						stroke : new ol.style.Stroke({
                        							color : &#x27;#000000&#x27;,
                        							width : 1
                        						}),
                        						text : new ol.style.Text({
                        				          font: &#x27;9px Calibri,sans-serif&#x27;,
                        				          text: text,
                        				          fill: new ol.style.Fill({
                        				            color: &#x27;#000&#x27;
                        				          })
                        						})
                        					})];
                        				}
                        				return styleCache[text];
                        			});
                        			envMap.setOpacity(0.6);
                        		},
                        		//d3viewonMap
                        		chartMapVisual : function(data){
                        			$(&#x27;#d3viewonMap&#x27;).show();

                        			var envRange=[];
                        			var xyData = this.JSONtoArray(data,this.envType,&#x27;stationName&#x27;);
                        			if(this.envType==&quot;pm10Value&quot;)
                        				envRange = this.PM10Range;
                        			else if(this.envType==&quot;coValue&quot;)
                        				envRange = this.CORange;
                        			else if(this.envType==&quot;no2Value&quot;)
                        				envRange = this.NO2Range;
                        			else if(this.envType==&quot;so2Value&quot;)
                        				envRange = this.SO2Range;
                        			else if(this.envType==&quot;o3Value&quot;)
                        				envRange = this.O3Range;
                        			openGDSM.d3.barchart(&#x27;d3viewonMap_sub&#x27;,xyData,this.colorRange,envRange);
                        			openGDSM.publicOpenData.env.mapVisual(data);

                        		},
                        		JSONtoArray: function(JSONdata,xValue,yValue){
                        			var xyAxis = new Array();
                        				xyAxis[0] = new Array();
                        				xyAxis[1] = new Array();
                        			var row = JSONdata.row;
                        			$.each(row, function(idx){
                        				xyAxis[0].push(row[idx][xValue]);
                        				xyAxis[1].push(row[idx][yValue]);
                        			});
                        			return xyAxis;
                        		}
                        };

                        openGDSM.d3 = {};

                        /**
                         * Create Bar Chart
                         * parameter : div id, xyAxis(2 dim Array), color (1 dim Array), range(1 dim Array)
                         */
                        openGDSM.d3.barchart = function(divId, xyData, color, range){
                        	var barHeight = 17;
                        	var minusWidth=0;
                        	$(&#x27;#&#x27;+divId).empty();
                        	var div = d3.select(&#x27;#&#x27;+divId).append(&quot;svg&quot;)
                        				.attr(&quot;id&quot;,&quot;barChart&quot;)
                        				.attr(&quot;width&quot;,$(&#x27;#&#x27;+divId).width())
                        				.attr(&quot;height&quot;,barHeight*xyData[0].length);
                        //	console.log(div);	console.log(xyData[0]);	console.log(color);	console.log(range);
                        	var maxData = d3.max(xyData[0]);
                        	var x = d3.scale.linear()
                        			.domain([0, maxData])
                        			.range([0,$(&#x27;#&#x27;+divId).width()]);
                        	div.selectAll(&#x27;rect&#x27;)
                        				.data(xyData[0])
                        				.enter()
                        					.append(&#x27;rect&#x27;)
                        					.attr(&#x27;x&#x27;,0)
                        					.attr(&#x27;y&#x27;,function(d,i){
                        						return i*barHeight;
                        					})
                        					.attr(&#x27;width&#x27;,function(d){
                        						return x(d)-minusWidth;
                        					})
                        					.attr(&#x27;height&#x27;,barHeight-2)
                        					.attr(&#x27;fill&#x27;,function(d,i){
                        						for(var z=0; z&lt;range.length; z++)
                        							if(xyData[0][i] &lt;=range[z]){
                        								return color[z];
                        							}
                        						return color[color.length];
                        					});
                        	div.selectAll(&#x27;g&#x27;)
                        				.data(xyData[1])
                        				.enter()
                        				.append(&#x27;text&#x27;)
                        					.attr(&#x27;x&#x27;,0)
                        					.attr(&#x27;y&#x27;,function(d,i){
                        						return i*barHeight+barHeight-5;
                        					})
                        					//.attr(&#x27;dy&#x27;,&#x27;.15em&#x27;)
                        					.attr(&#x27;font-weight&#x27;,&#x27;bold&#x27;)
                        					.attr(&#x27;font-size&#x27;,&#x27;0.9em&#x27;)
                        					.text(function(d){
                        						return d;
                        					});
                        	div.selectAll(&#x27;g&#x27;)
                        					.data(xyData[0])
                        					.enter()
                        					.append(&#x27;text&#x27;)
                        						.attr(&#x27;x&#x27;,function(d){
                        							return x(d)-minusWidth;
                        						})
                        						.attr(&#x27;y&#x27;,function(d,i){
                        							return i*barHeight+12;
                        						})
                        						.attr(&#x27;dy&#x27;,&#x27;.15em&#x27;)
                        						.attr(&#x27;fill&#x27;,&#x27;black&#x27;)
                        						.attr(&#x27;font-size&#x27;,&#x27;0.8em&#x27;)
                        						.attr(&#x27;font-weight&#x27;,&#x27;bold&#x27;)
                        						.text(function(d){
                        							return d;
                        						});
                        };


                        /**
                        *
                        *
                        */
                        openGDSM.d3.vectorMap ={
                        	readVector : function(features){

                        		var canvasFunction = function(extent,resolution,pixelRatio,size, projection){
                        			var canvasWidth = size[0];
                        			var canvasHeight = size[1];

                        			var canvas = d3.select(document.createElement(&#x27;canvas&#x27;));
                        			canvas.attr(&#x27;width&#x27;,canvasWidth).attr(&#x27;height&#x27;,canvasHeight);

                        			var context = canvas.node().getContext(&#x27;2d&#x27;);

                        			var d3Projection = d3.geo.mercator().scale(1).translate([0,0]);
                        			var d3Path = d3.geo.path().projection(d3Projection);

                        			var pixelBounds = d3Path.bounds(features);
                        			var pixelBoundsWidth = pixelBounds[1][0] - pixelBounds[0][0];
                        			var pixelBoundsHeight = pixelBounds[1][1] - pixelBounds[0][1];

                        			var geoBounds = d3.geo.bounds(features);
                        			var geoBoundsLeftBottom = ol.proj.transform(geoBounds[0], &#x27;EPSG:4326&#x27;,projection);
                        		    var geoBoundsRightTop = ol.proj.transform(geoBounds[1], &#x27;EPSG:4326&#x27;, projection);
                        		    var geoBoundsWidth = geoBoundsRightTop[0] - geoBoundsLeftBottom[0];
                        		    if (geoBoundsWidth &lt; 0) {
                        		        geoBoundsWidth += ol.extent.getWidth(projection.getExtent());
                        		    }
                        		    var geoBoundsHeight = geoBoundsRightTop[1] - geoBoundsLeftBottom[1];

                        		    var widthResolution = geoBoundsWidth / pixelBoundsWidth;
                        		    var heightResolution = geoBoundsHeight / pixelBoundsHeight;
                        		    var r = Math.max(widthResolution, heightResolution);
                        		    var scale = r / (resolution / pixelRatio);

                        		    var center = ol.proj.transform(ol.extent.getCenter(extent), projection, &#x27;EPSG:4326&#x27;);


                        		    d3Projection.scale(scale).center(center).translate([canvasWidth / 2, canvasHeight / 2]);
                        		    d3Path = d3Path.projection(d3Projection).context(context);
                        		    d3Path(features);
                        		    context.stroke();

                        		    return canvas[0][0];
                        		};
                        	}


                        };

                        /**
                         * Geoserver Setting // web.xml
                         * &lt;context-param&gt;
                         * &lt;param-name&gt;ENABLE_JSONP&lt;/param-name&gt;
                         * &lt;param-value&gt;true&lt;/param-value&gt;
                         * &lt;/context-param&gt;
                         */
                        var openGDSMGeoserver = {
                        		mapLayers : []
                        };

                        openGDSMGeoserver.getLayers = function(){
                        		 data = {ws:&#x27;opengds&#x27;};
                        		 if(this.mapLayers){
                        			 $.ajax({
                        					type:&#x27;POST&#x27;,
                        					url:serverURL+serverFolder+&#x27;getLayerNames.do&#x27;,
                        					data: JSON.stringify(data),
                        					contentType : &quot;application/json;charset=UTF-8&quot;,
                        					dataType : &#x27;json&#x27;,
                        					success:function(msg){
                        						openGDSMGeoserver.mapLayers = msg.data;
                        					},
                        					error:function(){
                        						console.log(&quot;err&quot;);
                        					}
                        			});
                        		 }
                        };
                        openGDSMGeoserver.wfs = function(olmap,url,workspace,layername,color,width,epsg){
                        	color = (typeof(color) !== &#x27;undefined&#x27;) ? color : &quot;rgba(255,255,255,0.5)&quot;;
                        	width = (typeof(width) !== &#x27;undefined&#x27;) ? width : &quot;1&quot;;
                        	epsg = (typeof(espg) !== &#x27;undefined&#x27;) ? epsg : &quot;EPSG:900913&quot;;
                        	vectorSource = new ol.source.ServerVector({
                        				format: new ol.format.GeoJSON(),
                        				loader: function(extent, resolution, projection){
                        					var urls = url+&#x27;geoserver/wfs?service=WFS&amp;&#x27; +
                        					&#x27;version=1.1.0&amp;request=GetFeature&#x27; +
                        					&#x27;&amp;typeNames=&#x27;+workspace+&#x27;:&#x27;+layername+
                        					&#x27;&amp;outputFormat=text/javascript&amp;format_options=callback:loadFeatures&#x27; +
                        					&#x27;&amp;srsname=&#x27;+epsg+&#x27;&amp;bbox=&#x27; + extent.join(&#x27;,&#x27;) + &#x27;,&#x27;+epsg;
                        					$.ajax({
                        						url : urls,
                        						dataType: &#x27;jsonp&#x27;
                        					});
                        				},
                        				strategy: ol.loadingstrategy.createTile(new ol.tilegrid.XYZ({
                        					maxZoom: 19
                        				})),
                        				projection: epsg
                        			});
                        			loadFeatures = function(response){
                        				vectorSource.addFeatures(vectorSource.readFeatures(response));
                        			};
                        	var styles = [
                        	      	    new ol.style.Style({
                        	      		  fill: new ol.style.Fill({
                        	      		    color: color,
                        	      		  }),
                        	      		  stroke: new ol.style.Stroke({
                        	      		    color: &#x27;#000000&#x27;,
                        	      		    width: 1
                        	      		  })
                        	      		})];
                        	var curLayers = olmap.getLayers().getArray();
                        	for(var i=0; i&lt;curLayers.length; i++){
                        		if( curLayers[i].get(&#x27;title&#x27;) == layername){
                        			olmap.removeLayer(curLayers[i]);
                        		}
                        	}
                        	var vectorTemp = new ol.layer.Vector({
                        	 	title:layername,
                        	   	source: vectorSource,
                        	   	style: styles
                        	  });
                        	olmap.addLayer(vectorTemp);
                        };



                        /*

                        openGDSMGeoserver.displayFeatureInfo = function(pixel){
                        	var feature = Map.map.forEachFeatureAtPixel(pixel, function(feature, layer){
                        		return feature;
                        	});

                        	if(feature){
                        		console.log(feature.get(&#x27;EMD_KOR_NM&#x27;));
                        	}
                        	else{

                        	}
                        };
                        */

                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>

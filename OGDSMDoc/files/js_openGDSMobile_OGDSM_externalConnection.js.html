<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>js/openGDSMobile/OGDSM_externalConnection.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title"></h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/OGDSM.html">OGDSM</a></li>
                                <li><a href="../classes/OGDSM.attributeTable.html">OGDSM.attributeTable</a></li>
                                <li><a href="../classes/OGDSM.eGovFramUI.html">OGDSM.eGovFramUI</a></li>
                                <li><a href="../classes/OGDSM.externalConnection.html">OGDSM.externalConnection</a></li>
                                <li><a href="../classes/OGDSM.mapLayerList.html">OGDSM.mapLayerList</a></li>
                                <li><a href="../classes/OGDSM.visualization.html">OGDSM.visualization</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/OGDSM.jsontoArray.html">OGDSM.jsontoArray</a></li>
                                <li><a href="../modules/OGDSM.namespace.html">OGDSM.namespace</a></li>
                                <li><a href="../modules/Sortable.create(...).html">Sortable.create(...)</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/openGDSMobile/OGDSM_externalConnection.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /** GeoServer, Public data, VWorld Connect Class **/
                        /*jslint devel: true, vars : true */
                        /*global $, jQuery, ol, OGDSM*/
                        OGDSM.namesapce(&#x27;externalConnection&#x27;);
                        (function (OGDSM) {
                            &#x27;use strict&#x27;;
                            /**
                             * 외부 데이터 접속 요청 객체
                             * @class OGDSM.externalConnection
                             * @constructor
                             */
                            OGDSM.externalConnection = function () {
                        
                            };
                            OGDSM.externalConnection.prototype = {
                                constructor : OGDSM.externalConnection
                            };
                            return OGDSM.externalConnection;
                        }(OGDSM));

                        /**
                         * GeoServer WFS 데이터 요청 (OpenLayers3 ol.source.GeoJSON)
                         * @method geoServerWFSLoad
                         * @param {OGDSM Obj} obj - OpenGDS Mobile 시각화 객체
                         * @param {String} addr - 주소
                         * @param {String} workspace - 워크스페이스
                         * @param {String} layerName - 레이어 이름
                         * @param {JSON Object} options - 옵션 JSON 객체 키 값{type=&#x27;polygon&#x27;, color=&#x27;rgba(0, 0, 0, 0.0)&#x27;, callback : function () {}}
                          type(String) : 레이어 타입( polygon | point)
                          color(String) : 색상 rgba
                          callback(Function) : 요청 후 색상 변경시 콜백 함수
                         */
                        OGDSM.externalConnection.prototype.geoServerWFSLoad = function (obj, addr, workspace, layerName, options) {
                            &#x27;use strict&#x27;;
                            options = (typeof (options) !== &#x27;undefined&#x27;) ? options : {};
                            var fullAddr = addr + &#x27;/geoserver/wfs?service=WFS&amp;version=1.1.0&amp;request=GetFeature&amp;typeNames=&#x27; + workspace + &#x27;:&#x27; + layerName +
                                &#x27;&amp;outputFormat=json&amp;srsname=&#x27; + obj.baseProj;
                            var objStyles, name;
                            var defaults = {
                                type : &#x27;polygon&#x27;,
                                color : &#x27;rgba(0, 0, 0, 0.0)&#x27;,
                                callback : function (wfslayer) {}
                            };
                            for (name in defaults) {
                                if (defaults.hasOwnProperty(name)) {
                                    if (options.hasOwnProperty(name)) {
                                        defaults[name] = options[name];
                                    }
                                }
                        	}
                            if (defaults.type === &#x27;polygon&#x27;) {
                                objStyles = [
                                    new ol.style.Style({
                                        fill : new ol.style.Fill({
                                            color : defaults.color
                                        }),
                                        stroke : new ol.style.Stroke({
                                            color : &#x27;rgba(0, 0, 0, 1.0)&#x27;,
                                            width : 1
                                        })
                                    })];
                            } else if (defaults.type === &#x27;point&#x27;) {
                                objStyles = [
                                    new ol.style.Style({
                                        image : new ol.style.Circle({
                                            radius : 5,
                                            fill : new ol.style.Fill({
                                                color : defaults.color
                                            }),
                                            stroke : new ol.style.Stroke({
                                                color : &#x27;rgba(0, 0, 0, 1.0)&#x27;,
                                                width : 1
                                            })
                                        })
                                    })
                                ];
                            }
                            $.mobile.loading(&#x27;show&#x27;, {
                                text : &#x27;Loading&#x27;,
                                textVisible : &#x27;true&#x27;,
                                theme : &#x27;c&#x27;,
                                textonlt : &#x27;false&#x27;
                            });
                            $.ajax({
                                type : &#x27;POST&#x27;,
                                url : fullAddr,
                                crossDomain: true,
                                dataType : &#x27;json&#x27;,
                                success : function (msg) {
                                    var wfsLayer = new ol.layer.Vector({
                                        title : layerName,
                                        source : new ol.source.GeoJSON({
                                            object: msg
                                        }),
                                        style : objStyles
                                    });
                                    obj.addMap(wfsLayer, defaults.type);
                                    $.mobile.loading(&#x27;hide&#x27;);
                                    defaults.callback(wfsLayer);
                                },
                                error : function (e) {
                                    console.log(e);
                                }
                            });
                        };
                        /**
                         * GeoServer WFS 요청 (OpenLayers3 ol.source.ServerVector)
                         * @method geoServerWFS
                         * @param {String} addr - 주소
                         * @param {String} ws - 워크스페이스
                         * @param {String} layerName - 레이어 이름
                         * @param {JSON Object} options - 옵션 JSON 객체 키 값{type=&#x27;polygon&#x27;, epsg=&#x27;epsg3857&#x27;}
                          type(String) : 레이어 타입( polygon | point)
                          epsg(String) : EPSG
                         * @return {ol.layer.Vector} vectorSource - OpenLayers3 백터 객체
                         */
                        OGDSM.externalConnection.prototype.geoServerWFS = function (addr, ws, layerName, options) {
                            options = (typeof (options) !== &#x27;undefined&#x27;) ? options : {};
                            var vectorSource, styles, resultData, name;

                            var defaults = {
                                type : &#x27;polygon&#x27;,
                                epsg : &#x27;epsg3857&#x27;
                            };
                            for (name in defaults) {
                                if (defaults.hasOwnProperty(name)) {
                                    if (options.hasOwnProperty(name)) {
                                        defaults[name] = options[name];
                                    }
                                }
                        	}

                            vectorSource = new ol.source.ServerVector({
                                format: new ol.format.GeoJSON(),
                                loader: function (extent, resolution, projection) {
                                    var fullAddr = addr + &#x27;/geoserver/wfs?service=WFS&amp;&#x27; +
                                        &#x27;version=1.1.0&amp;request=GetFeature&#x27; +
                                        &#x27;&amp;typeNames=&#x27; + ws + &#x27;:&#x27; + layerName +
                                        &#x27;&amp;outputFormat=text/javascript&amp;format_options=callback:loadFeatures&#x27; +
                                        &#x27;&amp;srsname=&#x27; + defaults.epsg + &#x27;&amp;bbox=&#x27; + extent.join(&#x27;,&#x27;) + &#x27;,&#x27; + defaults.epsg;
                                    $.ajax({
                                        url : fullAddr,
                                        dataType: &#x27;jsonp&#x27;
                                    });
                                },
                                strategy: ol.loadingstrategy.createTile(new ol.tilegrid.XYZ({
                                    maxZoom: 19
                                })),
                                projection: &#x27;EPSG:3857&#x27;
                            });
                            if (defaults.type === &#x27;polygon&#x27;) {
                                styles = [
                                    new ol.style.Style({
                                        fill: new ol.style.Fill({
                                            color: &#x27;#ff0000&#x27;
                                        }),
                                        stroke: new ol.style.Stroke({
                                            color: &#x27;#000000&#x27;,
                                            width: 1
                                        })
                                    })
                                ];
                            } else if (defaults.type === &#x27;point&#x27;) {
                                styles = [
                                    new ol.style.Style({
                                        image : new ol.style.Circle({
                                            radius : 5,
                                            fill : new ol.style.Fill({color : &#x27;#ff0000&#x27;}),
                                            stroke : new ol.style.Stroke({color : &#x27;#ff0000&#x27;, width : 1})
                                        })
                                    })
                                ];
                            }
                            loadFeatures = function (response) {
                                vectorSource.addFeatures(vectorSource.readFeatures(response));
                            };
                            resultData = new ol.layer.Vector({
                                title : layerName,
                                source : vectorSource,
                                style: styles
                            });
                            return resultData;
                        };
                        /**
                         * VWorld WMS 데이터 요청
                         * @method vworldWMSLoad
                         * @param {String} apiKey - api 키
                         * @param {String} domain - 도메인
                         * @param {String} data - WMS 레이어 이름
                         * @return {ol.layer.Tile} OpenLayers 타일 객체
                         */
                        OGDSM.externalConnection.prototype.vworldWMSLoad = function (apiKey, domain, data) {
                            &#x27;use strict&#x27;;
                            data = data.join(&#x27;,&#x27;);
                            var resultData = new ol.layer.Tile({
                                title : &#x27;VWorldWMS&#x27;,
                                source : new ol.source.TileWMS(({
                                    url : &#x27;http://map.vworld.kr/js/wms.do&#x27;,
                                    params : {
                                        apiKey : apiKey,
                                        domain : domain,
                                        LAYERS : data,
                                        STYLES : data,
                                        FORMAT : &#x27;image/png&#x27;,
                                        CRS : &#x27;EPSG:900913&#x27;,
                                        EXCEPTIONS : &#x27;text/xml&#x27;,
                                        TRANSPARENT : true
                                    }
                                }))
                            });
                            return resultData;
                        };

                        /**
                         * 서울 열린 데이터 광장 환경 데이터 요청
                         * @method seoulEnvironmentLoad
                         * @param {String} addr - 주소
                         * @param {String} apiKey - api 키
                         * @param {String} envType - 환경 정보 이름
                         * @param {date} date - 날짜
                         * @param {time} time - 시간
                         * @param {function} callback - 성공 콜백 함수
                         */
                        OGDSM.externalConnection.prototype.seoulEnvironmentLoad = function (addr, apiKey, envType, date, time, callback) {
                            &#x27;use strict&#x27;;
                            var parm = &#x27;{&quot;serviceName&quot;:&quot;TimeAverageAirQuality&quot;,&#x27; +
                                &#x27;&quot;keyValue&quot;:&quot;&#x27; + apiKey + &#x27;&quot;,&#x27; +
                                &#x27;&quot;dateValue&quot;:&quot;&#x27; + date + &#x27;&quot;, &#x27; +
                                &#x27;&quot;envType&quot;:&#x27; + &#x27;&quot;&#x27; + envType + &#x27;&quot;,&#x27; +
                                &#x27;&quot;timeValue&quot;:&quot;&#x27; + time + &#x27;&quot;} &#x27;;
                            var resultData;
                            parm = JSON.parse(parm);
                            console.log(parm);
                            $.mobile.loading(&#x27;show&#x27;, {
                                text : &#x27;Loading&#x27;,
                                textVisible : &#x27;true&#x27;,
                                theme : &#x27;c&#x27;,
                                textonlt : &#x27;false&#x27;
                            });
                            $.ajax({
                                type : &#x27;POST&#x27;,
                                url : addr,
                                data : JSON.stringify(parm),
                                contentType : &quot;application/json;charset=UTF-8&quot;,
                                dataType : &#x27;json&#x27;,
                                success : function (msg) {
                                    resultData = JSON.parse(msg.data);
                                    $.mobile.loading(&#x27;hide&#x27;);
                                    callback(resultData);
                                },
                                error : function (e) {
                                    console.log(e);
                                    $.mobile.loading(&#x27;hide&#x27;);
                                }
                            });
                        };


                        /**
                         * 데이터 포털 환경 데이터 요청
                         * @method seoulEnvironmentLoad
                         * @param {String} addr - 주소
                         * @param {String} apiKey - api 키
                         * @param {String} envType - 환경 정보 이름
                         * @param {date} date - 날짜
                         * @param {time} time - 시간
                         * @param {function} callback - 성공 콜백 함수
                         */
                        OGDSM.externalConnection.prototype.dataPortalEnvironmentLoad = function (addr, apiKey, envType, area, callback) {
                            &#x27;use strict&#x27;;
                            var parm = &#x27;{&quot;serviceName&quot;:&quot;ArpltnInforInqireSvc&quot;,&#x27; +
                                    &#x27; &quot;keyValue&quot;:&quot;&#x27; + apiKey + &#x27;&quot;,&#x27; +
                                    &#x27;&quot;areaType&quot;:&#x27; + &#x27;&quot;&#x27; + encodeURIComponent(area) + &#x27;&quot;,&#x27; +
                                    &#x27;&quot;envType&quot;:&#x27; + &#x27;&quot;&#x27; + envType + &#x27;&quot;}&#x27;;
                            var resultData;
                            parm = JSON.parse(parm);
                            console.log(parm);
                            $.mobile.loading(&#x27;show&#x27;, {
                                text : &#x27;Loading&#x27;,
                                textVisible : &#x27;true&#x27;,
                                theme : &#x27;c&#x27;,
                                textonlt : &#x27;false&#x27;
                            });
                            $.ajax({
                                type : &#x27;POST&#x27;,
                                url : addr,
                                data : JSON.stringify(parm),
                                contentType : &quot;application/json;charset=UTF-8&quot;,
                                dataType : &#x27;json&#x27;,
                                success : function (msg) {
                                    resultData = JSON.parse(msg.data);
                                    $.mobile.loading(&#x27;hide&#x27;);
                                    callback(resultData);
                                },
                                error : function (e) {
                                    console.log(e);
                                    $.mobile.loading(&#x27;hide&#x27;);
                                }
                            });
                        };
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>js/openGDSMobile/openGDSMSeoulOpenData.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title"></h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for:
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>

                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>

                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/OGDSM.html">OGDSM</a></li>
                                <li><a href="../classes/OGDSM.eGovFramUI.html">OGDSM.eGovFramUI</a></li>
                                <li><a href="../classes/OGDSM.externalConnection.html">OGDSM.externalConnection</a></li>
                                <li><a href="../classes/OGDSM.olMap.html">OGDSM.olMap</a></li>
                                <li><a href="../classes/OGDSM.visualization.html">OGDSM.visualization</a></li>
                            </ul>

                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/OGDSM.namespace.html">OGDSM.namespace</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>

                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>

                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>

                </div>

            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/openGDSMobile/openGDSMSeoulOpenData.js</h1>

                        <div class="file">
                            <pre class="code prettyprint linenums">
                        openGDSM.seoulOpenData = { };
                        var styleCache = {};
                        openGDSM.seoulOpenData.env = {
                        	key : &quot;6473565a72696e7438326262524174&quot;,
                        	serviceName : &#x27;&#x27;,
                        	envType : &#x27;&#x27;,
                        	visType : &#x27;&#x27;,
                        	mapLayer : &#x27;&#x27;,
                            olmap :&#x27;&#x27;,
                        	dateValue : &#x27;&#x27;,
                        	timeValue : &#x27;&#x27;,
                        	//colorRange : [&quot;#4c4cff&quot;,&quot;#9999FF&quot;,&quot;#4cff4c&quot;,&quot;#99ff99&quot;,&quot;#FFFF00&quot;,&quot;#FFFF99&quot;,&quot;#FF9900&quot;,&quot;#FF0000&quot;],
                        	colorRange : [&quot;#0090ff&quot;,&quot;#008080&quot;,&quot;#4cff4c&quot;,&quot;#99ff99&quot;,&quot;#FFFF00&quot;,&quot;#FFFF99&quot;,&quot;#FF9900&quot;,&quot;#FF0000&quot;],
                        	PM10Range : [15,30,55,80,100,120,200],
                        	PM25Range : [15,30,55,80,100,120,200],
                        	CORange : [1,2,5.5,9,10.5,12,15],
                        	NO2Range : [0.015,0.03,0.05,0.06,0.1045,0.15,0.2],
                        	SO2Range : [0.01,0.02,0.035,0.05,0.075,0.1,0.15],
                        	O3Range : [0.02,0.04,0.06,0.08,0.10,0.12,0.3],
                        	dataLoad : function(serviceName,apiKey, visType, envType, olmap, mapLayer, dateValue, timeValue){
                                olmap= (typeof(olmap) !== &#x27;undefined&#x27;) ? olmap : &quot;&quot;;
                        		mapLayer = (typeof(mapLayer) !== &#x27;undefined&#x27;) ? mapLayer : &quot;&quot;;
                        		dateValue = (typeof(dateValue) !== &#x27;undefined&#x27;) ? dateValue : &quot;&quot;;
                        		timeValue = (typeof(timeValue) !== &#x27;undefined&#x27;) ? timeValue : &quot;&quot;;
                        		this.serviceName = serviceName;
                        		this.envType = envType;
                        		this.visType = visType;
                                this.olmap = olmap;
                        		this.mapLayer = mapLayer;
                        		this.dateValue = dateValue;
                        		this.timeValue = timeValue;

                        		var data = &#x27;{&quot;serviceName&quot;:&quot;&#x27;+serviceName+&#x27;&quot;,&#x27;+
                        		   			&#x27; &quot;keyValue&quot;:&quot;&#x27;+apiKey+&#x27;&quot;,&#x27;+
                        		   			&#x27;&quot;dateValue&quot;:&#x27;+&#x27;&quot;&#x27;+dateValue+&#x27;&quot;,&#x27;+
                        		   			&#x27;&quot;timeValue&quot;:&#x27;+&#x27;&quot;&#x27;+timeValue+&#x27;&quot;}&#x27;;
                        			data=JSON.parse(data);
                        		$.ajax({
                        			type:&#x27;POST&#x27;,
                        			url:serverURL+serverFolder+&#x27;SeoulOpenData.do&#x27;,
                        			data: JSON.stringify(data),
                        			contentType : &quot;application/json;charset=UTF-8&quot;,
                        			dataType : &#x27;json&#x27;,
                        			success:function(msg){
                                        console.log(msg.data);
                        				if(visType==&#x27;chart&#x27;)
                        					openGDSM.seoulOpenData.env.chartVisual(JSON.parse(msg.data));
                        				else if(visType==&#x27;map&#x27;)
                        					openGDSM.seoulOpenData.env.mapVisual(JSON.parse(msg.data));
                        				else if(visType==&#x27;chartMap&#x27;)
                        					openGDSM.seoulOpenData.env.chartMapVisual(JSON.parse(msg.data));
                        			},
                        			error:function(){
                        				console.log(&quot;err&quot;);
                        			}
                        		});
                        	},
                        	chartVisual : function(data){
                        		$(&#x27;#dataSelect&#x27;).popup(&quot;open&quot;);
                        		var envRange=[];
                        		var xyData=this.xydivision(data[this.serviceName], this.envType, &#x27;MSRSTE_NM&#x27;);
                        		if(this.envType==&quot;PM10&quot;)
                        			envRange = this.PM10Range;
                        		else if(this.envType==&quot;PM25&quot;)
                        			envRange = this.PM25Range;
                        		else if(this.envType==&quot;CO&quot;)
                        			envRange = this.CORange;
                        		else if(this.envType==&quot;NO2&quot;)
                        			envRange = this.NO2Range;
                        		else if(this.envType==&quot;SO2&quot;)
                        			envRange = this.SO2Range;
                        		else if(this.envType==&quot;O3&quot;)
                        			envRange = this.O3Range;
                        		openGDSM.d3.barchart(&#x27;d3View&#x27;,xyData,this.colorRange,envRange);
                        	},
                        	/**
                        	 * SeoupOpenData Environment Data OpenLayers Style
                        	 */
                        	mapVisual: function(data){
                        		var envRange=[];
                        		var envMap=null;
                        		var curMaps=null;
                        		var xyData=this.xydivision(data[this.serviceName], this.envType, &#x27;MSRSTE_NM&#x27;);

                        		if(this.envType==&quot;PM10&quot;)
                        			envRange = this.PM10Range;
                        		else if(this.envType==&quot;PM25&quot;)
                        			envRange = this.PM25Range;
                        		else if(this.envType==&quot;CO&quot;)
                        			envRange = this.CORange;
                        		else if(this.envType==&quot;NO2&quot;)
                        			envRange = this.NO2Range;
                        		else if(this.envType==&quot;SO2&quot;)
                        			envRange = this.SO2Range;
                        		else if(this.envType==&quot;O3&quot;)
                        			envRange = this.O3Range;
                        		//WFS addLayer
                        		openGDSM.openGDSMGeoserver.wfs(this.olmap, geoServerURL,&#x27;opengds&#x27;,this.mapLayer);

                        		curMaps = Map.map.getLayers().getArray();
                        		for(var i=0; i&lt;curMaps.length; i++){
                        			if( curMaps[i].get(&#x27;title&#x27;) == this.mapLayer){
                        				envMap = curMaps[i];
                        			}
                        		}
                        		styleCache = {};
                        		envMap.setStyle(function(f,r){
                        			var text = r &lt; 5000 ? f.get(&#x27;SIG_KOR_NM&#x27;) : &#x27;&#x27;;
                        			if(!styleCache[text]){
                        				var color = &#x27;&#x27;;
                        				for(var i=0; i&lt;xyData[1].length; i++){
                        					if(text==xyData[1][i]){
                        						for(var j=0; j&lt;envRange.length; j++){
                        							if( xyData[0][i] &lt;= envRange[j] ){
                        								color = openGDSM.seoulOpenData.env.colorRange[j];
                        								break;
                        							}
                        						}
                        					}
                        				}
                        				styleCache[text] = [new ol.style.Style({
                        					fill : new ol.style.Fill({
                        						color : color
                        					}),
                        					stroke : new ol.style.Stroke({
                        						color : &#x27;#000000&#x27;,
                        						width : 1
                        					}),
                        					text : new ol.style.Text({
                        			          font: &#x27;9px Calibri,sans-serif&#x27;,
                        			          text: text,
                        			          fill: new ol.style.Fill({
                        			            color: &#x27;#000&#x27;
                        			          })
                        					})
                        				})];
                        			}
                        			return styleCache[text];
                        		});
                        		envMap.setOpacity(0.6);
                        /*
                        		$.ajax({
                        			type:&#x27;POST&#x27;,
                        			url:serverURL+serverFolder+&#x27;airQualityCreateMap.do&#x27;,
                        			data: JSON.stringify(data),
                        			contentType : &quot;application/json;charset=UTF-8&quot;,
                        			dataType : &#x27;json&#x27;,
                        			success:function(msg){
                                        $(&#x27;#interpolationMapImage&#x27;).attr(&#x27;src&#x27;,apacheServerURL+&#x27;aqm/resultImages/&#x27;+openGDSM.seoulOpenData.env.dateValue.split(&quot;-&quot;).join(&quot;&quot;)+openGDSM.seoulOpenData.env.timeValue.replace(&quot;:&quot;,&quot;&quot;)+openGDSM.seoulOpenData.env.envType+&#x27;_result.png&#x27;);
                                        $(&#x27;#interpolationMapImage&#x27;).attr(&#x27;height&#x27;,&#x27;250px&#x27;);
                                        $(&#x27;#interpolationMap&#x27;).show();

                                        //////
                                        $(&#x27;#d3viewonMap&#x27;).height(50);
                        		        $(&#x27;#d3viewonMap&#x27;).css(&#x27;top&#x27;,$(window).height()-50);
                                        $(&#x27;#d3viewonMap&#x27;).show();

                        			},
                        			error:function(){
                        				console.log(&quot;err&quot;);
                        			}
                        		});
                        */
                                        $(&#x27;#d3viewonMap&#x27;).height(50);
                                                $(&#x27;#d3viewonMap&#x27;).css(&#x27;top&#x27;,$(window).height()-50);
                                        $(&#x27;#d3viewonMap&#x27;).show();


                        	},
                        	chartMapVisual: function(data){
                        		$(&#x27;#d3viewonMap&#x27;).show();
                        		var envRange=[];
                        		var xyData=this.xydivision(data[this.serviceName], this.envType, &#x27;MSRSTE_NM&#x27;);
                        		if(this.envType==&quot;PM10&quot;)
                        			envRange = this.PM10Range;
                        		else if(this.envType==&quot;PM25&quot;)
                        			envRange = this.PM25Range;
                        		else if(this.envType==&quot;CO&quot;)
                        			envRange = this.CORange;
                        		else if(this.envType==&quot;NO2&quot;)
                        			envRange = this.NO2Range;
                        		else if(this.envType==&quot;SO2&quot;)
                        			envRange = this.SO2Range;
                        		else if(this.envType==&quot;O3&quot;)
                        			envRange = this.O3Range;
                        		openGDSM.d3.barchart(&#x27;d3viewonMap_sub&#x27;,xyData,this.colorRange,envRange);
                        		this.mapVisual(data);

                        	},
                        	/**
                        	 * SeoupOpenData Environment Data Division xData,yData
                        	 * parameter : JSON data
                        	 * return : 2 dim x axis and y axis   [0]: x Axis, [1] : y Axis
                        	 */
                        	xydivision: function(data, envType, yType){
                        		var xyAxis = new Array();
                        			xyAxis[0] = new Array();
                        			xyAxis[1] = new Array();
                        		var row = data.row;
                        		$.each(row, function(idx){
                        			xyAxis[0].push(row[idx][envType]);
                        			xyAxis[1].push(row[idx][&quot;MSRSTE_NM&quot;]);
                        		});
                        		return xyAxis;
                        	},
                        };

                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>

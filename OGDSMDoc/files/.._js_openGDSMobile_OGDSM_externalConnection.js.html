<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>../js/openGDSMobile/OGDSM_externalConnection.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title"></h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for:
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>

                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>

                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/OGDSM.html">OGDSM</a></li>
                                <li><a href="../classes/OGDSM.attributeTable.html">OGDSM.attributeTable</a></li>
                                <li><a href="../classes/OGDSM.eGovFrameUI.html">OGDSM.eGovFrameUI</a></li>
                                <li><a href="../classes/OGDSM.externalConnection.html">OGDSM.externalConnection</a></li>
                                <li><a href="../classes/OGDSM.mapLayerList.html">OGDSM.mapLayerList</a></li>
                                <li><a href="../classes/OGDSM.visualization.html">OGDSM.visualization</a></li>
                            </ul>

                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/OGDSM.applyOptions.html">OGDSM.applyOptions</a></li>
                                <li><a href="../modules/OGDSM.jsontoArray.html">OGDSM.jsontoArray</a></li>
                                <li><a href="../modules/OGDSM.namespace.html">OGDSM.namespace</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>

                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>

                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>

                </div>

            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../js/openGDSMobile/OGDSM_externalConnection.js</h1>

                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /** GeoServer, Public data, VWorld Connect Class **/
                        /*jslint devel: true, vars : true */
                        /*global $, jQuery, ol, OGDSM*/
                        OGDSM.namesapce(&#x27;externalConnection&#x27;);
                        (function (OGDSM) {
                            &#x27;use strict&#x27;;
                            /**
                             * 외부 데이터 접속 요청 객체
                             * @class OGDSM.externalConnection
                             * @constructor
                             */
                            OGDSM.externalConnection = function () {

                            };
                            OGDSM.externalConnection.prototype = {
                                constructor : OGDSM.externalConnection
                            };
                            return OGDSM.externalConnection;
                        }(OGDSM));

                        /**
                         * GeoServer WFS 데이터 요청 (OpenLayers3 ol.source.GeoJSON)
                         * @method geoServerGeoJsonLoad
                         * @param {OGDSM Obj} obj - OpenGDS Mobile 시각화 객체
                         * @param {String} addr - 주소
                         * @param {String} workspace - 워크스페이스
                         * @param {String} layerName - 레이어 이름
                         * @param {JSON Object} options - 옵션 JSON 객체 키 값&lt;br&gt;
                          {color:&#x27;rgba(0, 0, 0, 0.0)&#x27;, callback:function () {}}&lt;br&gt;
                          color(String) : 색상 rgba&lt;br&gt;
                          label(String) : 라벨&lt;br&gt;
                          callback(Function) : 콜백 함수 function (resultData) {...}
                         */
                        OGDSM.externalConnection.prototype.geoServerGeoJsonLoad = function (obj, addr, workspace, layerName, options) {
                            &#x27;use strict&#x27;;
                            options = (typeof (options) !== &#x27;undefined&#x27;) ? options : {};
                            var fullAddr = addr + &#x27;/geoserver/wfs?service=WFS&amp;version=1.1.0&amp;request=GetFeature&amp;typeNames=&#x27; + workspace + &#x27;:&#x27; + layerName +
                                &#x27;&amp;outputFormat=json&amp;srsname=&#x27; + obj.baseProj;
                            var objStyles, name;
                            var defaults = {
                                color : &#x27;rgba(0, 0, 0, 0.0)&#x27;,
                                label : null,
                                callback : function (wfslayer) {}
                            };
                            for (name in defaults) {
                                if (defaults.hasOwnProperty(name)) {
                                    if (options.hasOwnProperty(name)) {
                                        defaults[name] = options[name];
                                    }
                                }
                        	}
                            $.mobile.loading(&#x27;show&#x27;, {
                                text : &#x27;Loading&#x27;,
                                textVisible : &#x27;true&#x27;,
                                theme : &#x27;c&#x27;,
                                textonlt : &#x27;false&#x27;
                            });
                            layerName = layerName.replace(/[ \{\}\[\]\/?.,;:|\)*~&#x60;!\-+┼&lt;&gt;@\#$%&amp;\&#x27;\&quot;\\\(\=]/gi);
                            $.ajax({
                                type : &#x27;POST&#x27;,
                                url : fullAddr,
                                crossDomain: true,
                                dataType : &#x27;json&#x27;,
                                success : function (msg) {
                                    var wfsLayer = new ol.layer.Vector({
                                        title : layerName,
                                        source : new ol.source.Vector({
                                            features : (new ol.format.GeoJSON()).readFeatures(msg)
                                        }),
                                        style : (function () {
                                            var styleFill = new ol.style.Fill({
                                                color : defaults.color
                                            });
                                            var styleStroke = new ol.style.Stroke({
                                                color : &#x27;rgba(0, 0, 0, 1.0)&#x27;,
                                                width : 1
                                            });
                                            var styleCircle = new ol.style.Circle({
                                                radius : 10,
                                                fill : styleFill,
                                                stroke : styleStroke
                                            });
                                            return function (feature, resolution) {
                                                var type = feature.getGeometry().getType();
                                                var styleText = null;
                                                if (defaults.label !== null) {
                                                    styleText = new ol.style.Text({
                                                        font : &#x27;12px Calibri, sans-serif&#x27;,
                                                        text : feature.get(defaults.label),
                                                        fill : new ol.style.Fill({
                                                            color : &#x27;#000&#x27;
                                                        }),
                                                        stroke : new ol.style.Stroke({
                                                            color : &#x27;#fff&#x27;,
                                                            width : 3
                                                        })
                                                    });
                                                    feature.set(&#x27;label&#x27;, defaults.label);
                                                }
                                                //console.log(defaults.label);
                                                feature.set(&#x27;styleFill&#x27;, styleFill);
                                                feature.set(&#x27;styleStroke&#x27;, styleStroke);
                                                feature.set(&#x27;styleCircle&#x27;, styleCircle);
                                                feature.set(&#x27;styleText&#x27;, styleText);
                                                if (type === &#x27;MultiPolygon&#x27;) {
                                                    return [new ol.style.Style({
                                                        fill : styleFill,
                                                        stroke : styleStroke,
                                                        text : styleText
                                                    })];
                                                } else if (type === &#x27;Point&#x27;) {
                                                    return [new ol.style.Style({
                                                        image : styleCircle,
                                                        text : styleText
                                                    })];
                                                }
                                            };
                                        }())
                                    });
                                    wfsLayer.set(&#x27;styleFill&#x27;, defaults.color);
                                    obj.addMap(wfsLayer, defaults.type);
                                    $.mobile.loading(&#x27;hide&#x27;);
                                    defaults.callback(wfsLayer);
                                },
                                error : function (e) {
                                    console.log(e);
                                }
                            });
                        };
                        /**
                         * GeoServer WFS 요청 (OpenLayers3 ol.source.ServerVector)
                         * @method geoServerWFS
                         * @param {String} addr - 주소
                         * @param {String} ws - 워크스페이스
                         * @param {String} layerName - 레이어 이름
                         * @param {JSON Object} options - 옵션 JSON 객체 키 값&lt;br&gt;
                          {type:&#x27;polygon&#x27;, epsg:&#x27;epsg3857&#x27;}&lt;br&gt;
                          type(String) : 레이어 타입( polygon | point)&lt;br&gt;
                          epsg(String) : EPSG String&lt;br&gt;
                         * @return {ol.layer.Vector} vectorSource - OpenLayers3 백터 객체
                         */
                        /*
                        OGDSM.externalConnection.prototype.geoServerWFS = function (addr, ws, layerName, options) {
                            options = (typeof (options) !== &#x27;undefined&#x27;) ? options : {};
                            var vectorSource, styles, resultData, name;

                            var defaults = {
                                type : &#x27;polygon&#x27;,
                                epsg : &#x27;epsg3857&#x27;
                            };
                            for (name in defaults) {
                                if (defaults.hasOwnProperty(name)) {
                                    if (options.hasOwnProperty(name)) {
                                        defaults[name] = options[name];
                                    }
                                }
                        	}

                            vectorSource = new ol.source.ServerVector({
                                format: new ol.format.GeoJSON(),
                                loader: function (extent, resolution, projection) {
                                    var fullAddr = addr + &#x27;/geoserver/wfs?service=WFS&amp;&#x27; +
                                        &#x27;version=1.1.0&amp;request=GetFeature&#x27; +
                                        &#x27;&amp;typeNames=&#x27; + ws + &#x27;:&#x27; + layerName +
                                        &#x27;&amp;outputFormat=text/javascript&amp;format_options=callback:loadFeatures&#x27; +
                                        &#x27;&amp;srsname=&#x27; + defaults.epsg + &#x27;&amp;bbox=&#x27; + extent.join(&#x27;,&#x27;) + &#x27;,&#x27; + defaults.epsg;
                                    $.ajax({
                                        url : fullAddr,
                                        dataType: &#x27;jsonp&#x27;
                                    });
                                },
                                strategy: ol.loadingstrategy.createTile(new ol.tilegrid.XYZ({
                                    maxZoom: 19
                                })),
                                projection: &#x27;EPSG:3857&#x27;
                            });
                            if (defaults.type === &#x27;polygon&#x27;) {
                                styles = [
                                    new ol.style.Style({
                                        fill: new ol.style.Fill({
                                            color: &#x27;#ff0000&#x27;
                                        }),
                                        stroke: new ol.style.Stroke({
                                            color: &#x27;#000000&#x27;,
                                            width: 1
                                        })
                                    })
                                ];
                            } else if (defaults.type === &#x27;point&#x27;) {
                                styles = [
                                    new ol.style.Style({
                                        image : new ol.style.Circle({
                                            radius : 5,
                                            fill : new ol.style.Fill({color : &#x27;#ff0000&#x27;}),
                                            stroke : new ol.style.Stroke({color : &#x27;#ff0000&#x27;, width : 1})
                                        })
                                    })
                                ];
                            }
                            loadFeatures = function (response) {
                                vectorSource.addFeatures(vectorSource.readFeatures(response));
                            };
                            resultData = new ol.layer.Vector({
                                title : layerName,
                                source : vectorSource,
                                style: styles
                            });
                            return resultData;
                        };
                        */
                        /**
                         * VWorld WMS 데이터 요청
                         * @method vworldWMSLoad
                         * @param {String} apiKey - API 키
                         * @param {String} domain - 도메인
                         * @param {String} data - WMS 레이어 이름
                         * @return {ol.layer.Tile} OpenLayers 타일 객체
                         */
                        OGDSM.externalConnection.prototype.vworldWMSLoad = function (apiKey, domain, data) {
                            &#x27;use strict&#x27;;
                            data = data.join(&#x27;,&#x27;);
                            var resultData = new ol.layer.Tile({
                                title : &#x27;VWorldWMS&#x27;,
                                source : new ol.source.TileWMS(({
                                    url : &#x27;http://map.vworld.kr/js/wms.do&#x27;,
                                    params : {
                                        apiKey : apiKey,
                                        domain : domain,
                                        LAYERS : data,
                                        STYLES : data,
                                        FORMAT : &#x27;image/png&#x27;,
                                        CRS : &#x27;EPSG:900913&#x27;,
                                        EXCEPTIONS : &#x27;text/xml&#x27;,
                                        TRANSPARENT : true
                                    }
                                }))
                            });
                            return resultData;
                        };

                        /**
                         * 공공 데이터 요청 인터페이스
                         * @method publicDataInterface
                         * @param {String} addr - 어플리케이션 서버 요청 주소
                         * @param {JSON Object} jsonData - 데이터 요청 파라미터 {serviceName : ??(필수), serviceKey ??(필수), ...}
                         * @param {function} callback - 콜백 함수 function (resultData) {...}
                         *
                         */
                        OGDSM.externalConnection.prototype.publicDataInterface = function (addr, jsonData, callback) {
                            &#x27;use strict&#x27;;
                            $.mobile.loading(&#x27;show&#x27;, {
                                text : &#x27;Loading&#x27;,
                                textVisible : &#x27;true&#x27;,
                                theme : &#x27;c&#x27;,
                                textonlt : &#x27;false&#x27;
                            });
                            $.ajax({
                                type : &#x27;POST&#x27;,
                                url : addr,
                                data : JSON.stringify(jsonData),
                                contentType : &quot;application/json;charset=UTF-8&quot;,
                                dataType : &#x27;json&#x27;,
                                success : function (jsonResult) {
                                    $.mobile.loading(&#x27;hide&#x27;);
                                    if (jsonResult.result === &#x27;OK&#x27;) {
                                        callback(JSON.parse(jsonResult.data));
                                    } else {
                                        alert(&quot;데이터를 불러오는데 실패하였습니다&quot;);
                                    }
                                },
                                error : function (error) {
                                    $.mobile.loading(&#x27;hide&#x27;);
                                    console.error(error);
                                }
                            });
                        };


                        /**
                         * 서울 열린 데이터 광장 환경 데이터 요청
                         * @method seoulEnvironmentLoad
                         * @param {String} addr - 주소
                         * @param {String} apiKey - api 키
                         * @param {String} envType - 환경 정보 이름
                         * @param {date} date - 날짜 (YYYYMMDD)
                         * @param {time} time - 시간 (HH00)
                         * @param {function} callback - 콜백 함수 function (resultData) {...}
                         */
                        OGDSM.externalConnection.prototype.seoulEnvironmentLoad = function (addr, apiKey, envType, date, time, callback) {
                            &#x27;use strict&#x27;;
                            var jsonData = {};
                            jsonData.serviceKey = apiKey;
                            jsonData.returnType = &#x27;json&#x27;;
                            jsonData.serviceName = &#x27;TimeAverageAirQuality&#x27;;
                            jsonData.amount = &#x27;1/100&#x27;;
                            jsonData.dateTimeValue = date + time;
                            jsonData.envType = envType;

                            this.publicDataInterface(addr, jsonData, function (resultData) {
                                callback(resultData);
                            });
                        };


                        /**
                         * 데이터 포털 환경 데이터 요청
                         * @method dataPortalEnvironmentLoad
                         * @param {String} addr - 주소
                         * @param {String} apiKey - API 키
                         * @param {String} envType - 환경 정보 이름
                         * @param {String} area - 지역
                         * @param {function} callback - 콜백 함수 function (resultData) {...}
                         */
                        OGDSM.externalConnection.prototype.dataPortalEnvironmentLoad = function (addr, apiKey, envType, area, callback) {
                            &#x27;use strict&#x27;;
                            var jsonData = {};
                            jsonData.serviceName = &#x27;ArpltnInforInqireSvc&#x27;;
                            jsonData.numOfRows = &#x27;100&#x27;;
                            jsonData.serviceKey = apiKey;
                            jsonData.envType = envType;
                            jsonData.sidoName = encodeURIComponent(area);

                            this.publicDataInterface(addr, jsonData, function (resultData) {
                                callback(resultData);
                            });
                        };


                        /**
                         * 데이터 포털 온실가스배출량 조회 서비스
                         * @method greenGasEmissionLoad
                         * @param {String} addr - 주소
                         * @param {String} apiKey - API 키
                         * @param {String} startDate - 시작 날짜 (YYYYMM 200701 ~ 201412 까지만 데이터 존재)
                         * @param {String} endDate - 종료 날짜 (YYYYMM 200701 ~ 201412 까지만 데이터 존재)
                         * @param {function} callback - 성공 콜백 함수
                         */
                        OGDSM.externalConnection.prototype.greenGasEmissionLoad = function (addr, apiKey, startDate, endDate, callback) {
                            &#x27;use strict&#x27;;
                            var jsonData = {};
                            jsonData.serviceName = &#x27;GreenGasEmissionReport&#x27;;
                            jsonData.numOfRows = &#x27;100&#x27;;
                            jsonData.serviceKey = apiKey;
                            jsonData.startDate = startDate;
                            jsonData.endDate = endDate;

                            this.publicDataInterface(addr, jsonData, function (resultData) {
                                callback(resultData);
                            });
                        };


                        /**
                         * 원자력발전소 실시간 주변 방사선량
                         * @method realTimeLevelofRadiationLoad
                         * @param {String} addr - 주소
                         * @param {String} apiKey - API 키
                         * @param {String} genName - 원자력 발전소 이름 (WS, KR, YK, Plant)
                         * @param {function} callback - 성공 콜백 함수
                         */
                        OGDSM.externalConnection.prototype.realTimeLevelofRadiationLoad = function (addr, apiKey, genName, callback) {
                            &#x27;use strict&#x27;;
                            var jsonData = {};
                            jsonData.serviceName = &#x27;NuclearPowerPlantRealtimeLevelofRadiation&#x27;;
                            jsonData.serviceKey = apiKey;
                            jsonData.startDate = genName;

                            this.publicDataInterface(addr, jsonData, function (resultData) {
                                callback(resultData);
                            });
                        };

                        /**
                         * geoServer 데이터 리스트 요청
                         * @method getLayersGeoServer
                         * @param {String} addr - 서버 주소
                         * @param {String} wsName - 워크스페이스 이름
                         * @param {Function} callback - 콜백 함수 function (resultData) {...}
                         */
                        OGDSM.externalConnection.prototype.getLayersGeoServer = function (addr, wsName, callback) {
                            &#x27;use strict&#x27;;
                            var parm = { wsName : wsName };
                            $.mobile.loading(&#x27;show&#x27;, {
                                text : &#x27;Loading&#x27;,
                                textVisible : &#x27;true&#x27;,
                                theme : &#x27;c&#x27;,
                                textonlt : &#x27;false&#x27;
                            });
                            $.ajax({
                                type : &#x27;POST&#x27;,
                                url : addr,
                                data : JSON.stringify(parm),
                                contentType : &#x27;application/json;charset=UTF-8&#x27;,
                                dataType : &#x27;json&#x27;,
                                success : function (msg) {
                                    var resultData = msg.data;
                                    $.mobile.loading(&#x27;hide&#x27;);
                                    callback(resultData);
                                },
                                error : function (error) {
                                    console.error(error);
                                }
                            });
                        };

                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>

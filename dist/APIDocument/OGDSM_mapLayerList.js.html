<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>OGDSM_mapLayerList.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="OGDSM.html">OGDSM</a></li><li><a href="OGDSM.attributeTable.html">attributeTable</a><ul class='methods'><li data-type='method'><a href="OGDSM.attributeTable.html#.getEidtMode">getEidtMode</a></li><li data-type='method'><a href="OGDSM.attributeTable.html#.getSelectObj">getSelectObj</a></li></ul></li><li><a href="OGDSM.chartVisualization.html">chartVisualization</a></li><li><a href="OGDSM.eGovFrameUI.html">eGovFrameUI</a></li><li><a href="OGDSM.externalConnection.html">externalConnection</a></li><li><a href="OGDSM.mapLayerList.html">mapLayerList</a></li><li><a href="OGDSM.visualization.html">visualization</a><ul class='methods'><li data-type='method'><a href="OGDSM.visualization.html#getLayersTitle">getLayersTitle</a></li></ul></li><li><a href="OGDSM.webSocket.html">webSocket</a></li></ul><h3>Modules</h3><ul><li><a href="OGDSM.module_applyOptions.html">applyOptions</a></li><li><a href="OGDSM.module_indexedDB.html">indexedDB</a></li><li><a href="OGDSM.module_jsontoArray.html">jsontoArray</a></li><li><a href="OGDSM.module_namespace.html">namespace</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addAttribute">addAttribute</a></li><li><a href="global.html#addList">addList</a></li><li><a href="global.html#addMap">addMap</a></li><li><a href="global.html#ajaxRequest">ajaxRequest</a></li><li><a href="global.html#areaChart">areaChart</a></li><li><a href="global.html#autoButton">autoButton</a></li><li><a href="global.html#autoCheckBox">autoCheckBox</a></li><li><a href="global.html#autoListView">autoListView</a></li><li><a href="global.html#autoRadioBox">autoRadioBox</a></li><li><a href="global.html#autoSelect">autoSelect</a></li><li><a href="global.html#autoSwitch">autoSwitch</a></li><li><a href="global.html#baseMapRadioBox">baseMapRadioBox</a></li><li><a href="global.html#baseMapSelect">baseMapSelect</a></li><li><a href="global.html#changeBaseMap">changeBaseMap</a></li><li><a href="global.html#changeWFSStyle">changeWFSStyle</a></li><li><a href="global.html#dataPortalEnvironment">dataPortalEnvironment</a></li><li><a href="global.html#dataPortalEnvironmentLoad">dataPortalEnvironmentLoad</a></li><li><a href="global.html#dataPortalGreenGas">dataPortalGreenGas</a></li><li><a href="global.html#dataPortalNuclear">dataPortalNuclear</a></li><li><a href="global.html#dateInput">dateInput</a></li><li><a href="global.html#formAjaxRequest">formAjaxRequest</a></li><li><a href="global.html#geoServerGeoJsonLoad">geoServerGeoJsonLoad</a></li><li><a href="global.html#getAttrObj">getAttrObj</a></li><li><a href="global.html#getCurTab">getCurTab</a></li><li><a href="global.html#getEidtMode">getEidtMode</a></li><li><a href="global.html#getLayersGeoServer">getLayersGeoServer</a></li><li><a href="global.html#getMap">getMap</a></li><li><a href="global.html#greenGasEmissionLoad">greenGasEmissionLoad</a></li><li><a href="global.html#hBarChart">hBarChart</a></li><li><a href="global.html#imageLayer">imageLayer</a></li><li><a href="global.html#indexOf">indexOf</a></li><li><a href="global.html#layerCheck">layerCheck</a></li><li><a href="global.html#lineChart">lineChart</a></li><li><a href="global.html#olMapView">olMapView</a></li><li><a href="global.html#publicDataInterface">publicDataInterface</a></li><li><a href="global.html#realTimeLevelofRadiationLoad">realTimeLevelofRadiationLoad</a></li><li><a href="global.html#removeAttribute">removeAttribute</a></li><li><a href="global.html#removeList">removeList</a></li><li><a href="global.html#removeMap">removeMap</a></li><li><a href="global.html#selectAttribute">selectAttribute</a></li><li><a href="global.html#seoulEnvironment">seoulEnvironment</a></li><li><a href="global.html#seoulEnvironmentLoad">seoulEnvironmentLoad</a></li><li><a href="global.html#setCurTab">setCurTab</a></li><li><a href="global.html#setSelectObj">setSelectObj</a></li><li><a href="global.html#setVisible">setVisible</a></li><li><a href="global.html#timeInput">timeInput</a></li><li><a href="global.html#trackingGeoLocation">trackingGeoLocation</a></li><li><a href="global.html#updateLayoutSetting">updateLayoutSetting</a></li><li><a href="global.html#vBarChart">vBarChart</a></li><li><a href="global.html#vworldWMSList">vworldWMSList</a></li><li><a href="global.html#vworldWMSLoad">vworldWMSLoad</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">OGDSM_mapLayerList.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*jslint devel: true, vars : true plusplus : true*/
/*global $, jQuery, ol, OGDSM, d3, Sortable*/
OGDSM.namesapce('mapLayerList');

(function (OGDSM) {
    "use strict";
    var arrlayerObjs = [], arrlabels = [];
    var attrObj = null;
    /**
     * 오픈레이어 맵 레이어 목록 객체
     * @class OGDSM.mapLayerList
     * @constructor
     * @param {OGDSM.visualization} obj - OGDSM 시각화 객체
     * @param {String} listDiv - 생성할 list DIV 이름
     * @param {JSON Object} options - 옵션 JSON 객체 키 값&lt;br>
     {listWidthSize:200, buttonSize:100, btnType:'img', btnHTML:'레이어', bgColor: 'rgb(255, 255, 255, 0.0), &lt;br>
      listColor: 'rgba(255,255,255, 0.0)', titleColor: 'rgba(255, 255, 255, 1.0)', titleHTML: '레이어 목록', attrObj: null}&lt;br>
      listWidthSize : 리스트 너비&lt;br>
      buttonSize: 리스트 On/Off 버튼 사이즈&lt;br>
      btnSW : true&lt;br>
      btnType : 버튼 타입 (text | img)&lt;br>
      bgColor : 전체 배경 색 &lt;br>
      listColor : 리스트 배경 색&lt;br>
      titleColor : 타이틀 배경 색 &lt;br>
      titleHTML : 타이틀 내용 &lt;br>
      attrObj : 속성정보 시각화 객체 &lt;br>
     */
    OGDSM.mapLayerList = function (obj, listDiv, options) {
        options = (typeof (options) !== 'undefined') ? options : {};
        var defaults = {
            listWidthSize : 200,
            buttonSize : 100,
            btnSW : true, //향후 추가...
            btnType : 'img',
            btnHTML : '&lt;span style="font-size:15">레이어&lt;/span>',
            bgColor : 'rgba(255, 255, 255, 0.0)',
            listColor : 'rgba(255, 255, 255, 0.0)',
            titleColor : 'rgba(255, 255, 255, 1.0)',
            titleHTML : '&lt;span style="font-weight:bold;">레이어 목록&lt;/span>',
            attrObj : null
        };
        defaults = OGDSM.applyOptions(defaults, options);
        this.listDiv = listDiv;
        this.visualizationObj = obj;
        this.attrObj = defaults.attrObj;
        var thisObj = this;
        var handleList = null,
            rootElement = document.getElementById(listDiv),
            buttonElement = document.createElement('div'),
            listTitleElement = document.createElement('div'),
            listRootElement = document.createElement('div'),
            listUlElement = document.createElement('ul'),
            rootElementCSS = 'position : absolute; top: 0px;  z-index : 1; background : ' + defaults.bgColor + ';',
            buttonCSS = 'cursor:pointer; position : absolute; left :' +
                            defaults.listWidthSize + 'px;' + 'width : ' + defaults.buttonSize + 'px;',
            listRootCSS = 'float : left; padding : 1px;	background : ' +
                            defaults.listColor + ';' + 'width : ' + defaults.listWidthSize + 'px;',
            listTitleCSS = 'width: 100%; margin-bottom:10px; margin-top:10px; text-align:center; background :' + defaults.titleColor + ';',
            listUlCSS = 'list-style:none; padding:0; margin:0;',
            listSlideHideCSS = ' left: ' + -(defaults.listWidthSize) + 'px; transition: left 0.1s ease;',
            listSlideShowCSS = ' left: 0px; transition: left 0.1s ease;';

        var buttonSlideShowCSS = 'left:' + (defaults.listWidthSize) + 'px; ' + 'transition : background 0.1s ease, left 0.1s ease;',
            buttonSlideHideCSS = 'left:' + (defaults.listWidthSize - 25) + 'px; ' + 'transition : background 0.1s ease, left 0.1s ease;';


        handleList = function (e) {
            if (this.value === 'hide') {
                this.value = 'show';
                rootElement.style.cssText = rootElementCSS + listSlideShowCSS;
                buttonElement.style.cssText = buttonCSS + buttonSlideHideCSS;
            } else {
                this.value = 'hide';
                rootElement.style.cssText = rootElementCSS + listSlideHideCSS;
                buttonElement.style.cssText = buttonCSS + buttonSlideShowCSS;
            }
        };
        buttonElement.value = 'hide';
        buttonElement.id = listDiv + 'Button';
        buttonElement.style.cssText = buttonCSS + buttonSlideShowCSS;
        if (defaults.btnType === 'text') {
            buttonElement.innerHTML = defaults.btnHTML;
        } else {
            buttonElement.innerHTML = '&lt;a href="#" data-role="button" data-icon="grid" data-iconpos="notext" data-corners="false">&lt;/a>';
        }
        buttonElement.addEventListener('click', handleList, false);
        buttonElement.addEventListener('touchstart', handleList, false);



        listTitleElement.style.cssText = listTitleCSS;
        listTitleElement.innerHTML = defaults.titleHTML;
        listUlElement.id = listDiv + 'Contents';
        listUlElement.style.cssText = listUlCSS;


        listRootElement.id = listDiv + 'Root';
        listRootElement.style.cssText = listRootCSS;
        listRootElement.appendChild(listTitleElement);
        listRootElement.appendChild(listUlElement);

        rootElement.style.cssText = rootElementCSS + listSlideHideCSS;
        rootElement.appendChild(buttonElement);
        rootElement.appendChild(listRootElement);

        $('#' + listDiv + 'Button').trigger('create');
        this.ulObj = Sortable.create(document.getElementById(this.listDiv + 'Contents'), {
            animation: 150,
            handle: '.drag-handle',
            onUpdate : function (evt) {
                var labels = thisObj.getLabels(), i,
                    objs = thisObj.getLayersObj(),
                    ogdsmObj = thisObj.getVisualizationObj(),
                    length = labels.length - 1,
                    layers = ogdsmObj.getMap().getLayers(),
                    changeValue = labels[length - evt.oldIndex],
                    changeObj = objs[length - evt.oldIndex];
                if (evt.oldIndex > evt.newIndex) {
                    for (i = length - evt.oldIndex; i &lt; length - evt.newIndex; i++) {
                        labels[i] = labels[i + 1];
                        objs[i] = objs[i + 1];
                    }
                    labels[length - evt.newIndex] = changeValue;
                    objs[length - evt.newIndex] = changeObj;
                } else {
                    for (i = length - evt.oldIndex; i > length - evt.newIndex; i--) {
                        labels[i] = labels[i - 1];
                        objs[i] = objs[i - 1];
                    }
                    labels[length - evt.newIndex] = changeValue;
                    objs[length - evt.newIndex] = changeObj;
                }
                for (i = 0; i &lt; objs.length; i++) {
                    layers.pop();
                }
                for (i = 0; i &lt; objs.length; i++) {
                    layers.setAt(i + 1, objs[i]);
                }
                thisObj.setLayersObj(objs);
                thisObj.setLabels(labels);
            }
        });

    };
    OGDSM.mapLayerList.prototype = {
        constructor : OGDSM.mapLayerList,
        getLayersObj : function () {
            return arrlayerObjs;
        },
        setLayerObj : function (obj) {
            arrlayerObjs.push(obj);
        },
        setLayersObj : function (objs) {
            arrlayerObjs = objs;
        },
        getLabels : function () {
            return arrlabels;
        },
        setLabel : function (label) {
            arrlabels.push(label);
        },
        setLabels : function (labels) {
            arrlabels = labels;
        },
        getVisualizationObj : function () {
            return this.visualizationObj;
        },
        getThis : function () {
            return this;
        }
    };
    return OGDSM.mapLayerList;
}(OGDSM));
/**
 * 레이어 목록 추가
 * @method addList
 * @param {ol3 layer object} obj - 레이어 목록에 추가할 Openlayers3 레이어 객체
 * @param {String} label - 목록 이름
 * @param {String} color - 레이어 색상 (ex: rgb(255,255,255))
 * @param {String} type - 객체 타입 (polygon | point | line)
 */
OGDSM.mapLayerList.prototype.addList = function (obj, label, color, type) {
    'use strict';
    type = (typeof (type) !== 'undefined') ? type : null;
    var i, olList = $('#' + this.listDiv + 'Contents'),
        thisObj = this,
        labels = this.getLabels(),
        objs = this.getLayersObj(),
        ogdsmObj = this.visualizationObj,
        attrObj = this.attrObj;
    this.setLayerObj(obj);
    this.setLabel(label);
    function sliderEvent(e, u) {
        var layerName = e.currentTarget.getAttribute('data-label'),
            opacityValue = e.currentTarget.value,
            layerObj = ogdsmObj.layerCheck(layerName);
        layerObj.setOpacity(opacityValue / 100.0);
    }
    function deleteEvent(e, u) {
        var layerName = e.currentTarget.getAttribute('data-label');
        var labels = thisObj.getLabels();
        var layerNum = $.inArray(layerName, labels);
        ogdsmObj.removeMap(layerName);
        labels.splice(layerNum, 1);
        objs.splice(layerNum, 1);
        thisObj.setLayersObj(objs);
        thisObj.setLabels(labels);
        $('#layer' + layerName).remove();
        $('#popup' + layerName).remove();
        //$('#popup' + layerName + '-screen').remove();
        //$('#popup' + layerName + '-popup').remove();
        if (attrObj !==  null) {
            attrObj.removeAttribute(layerName);
        }
    }
    function checkBoxEvent(e, u) {
        var layerName = e.currentTarget.getAttribute('data-label');
        if (!e.currentTarget.checked) {
            ogdsmObj.setVisible(layerName, false);
        } else {
            ogdsmObj.setVisible(layerName, true);
        }
    }
    var sublabel = label;
    if (label.length > 10) {
        sublabel = sublabel.substr(0, 10) + '...';
    }
    olList.prepend('&lt;li id="layer' + label + '" style="float:left;">' +
                   '&lt;fieldset data-role="controlgroup" data-type="horizontal" style="margin:0px">' +
                   '&lt;div style="width:15%; float:left;">' +
                   '&lt;canvas id="' + label + 'canvas" width="100%" height=30px; class="drag-handle" >&lt;/canvas>' +
                   '&lt;/div> &lt;div id="chkRoot' + label + '" style="width:60%; float:left; padding:0px; margin:0px;">' +
                   '&lt;input type="checkbox" name="listCheckBox" data-corners="false" data-mini="true" class="custom" ' +
                   'id="' + 'visualSW' + thisObj.getLabels().length + '" data-label="' + label + '" checked/>' +
                   '&lt;label for="' + 'visualSW' + thisObj.getLabels().length + '" style="width:100%">' + sublabel + '&lt;/label>' +
                   '&lt;/div> &lt;div style="width:25%; float:left;">' +
                   '&lt;a id="hrefRoot' + label + '" data-role="button" data-rel="popup" data-theme="b" data-icon="gear"' +
                   'data-corners="false" data-transition="pop" data-iconpos="notext"  data-mini="true" ' +
                   'data-label="' + label + '" href="#popup' + label + '" style="width:25%; height:6px;">&lt;/a>' +
                   '&lt;/div>' +
                   '&lt;/fieldset>' +
                   '&lt;div data-role="popup" id="popup' + label + '" style="width:' + 200 + 'px">' +
                   '&lt;input type="range" value="100" min="0" max="100" data-highlight="true" class="layer-manager"' +
                   'id="' + label + 'slider" data-label="' + label + '">' +
                   '&lt;a data-role="button" data-theme="f" data-mini="true"' +
                   'id="' + label + 'delete" data-label="' + label + '">Delete&lt;/a>' +
                   '&lt;/div>' +
                   '&lt;/li>'); //　   style="width:25%;"
    var labelCanvas = document.getElementById(label + 'canvas').getContext('2d');
    if (type === 'MultiPolygon') {
        labelCanvas.fillStyle = color;
        labelCanvas.fillRect(5, 5, 20, 20);
        labelCanvas.strokeRect(5, 5, 20, 20);
    } else if (type === 'Point') {
        labelCanvas.beginPath();
        labelCanvas.arc(15, 15, 12, 0, 2 * Math.PI);
        labelCanvas.fillStyle = color;
        labelCanvas.fill();
        labelCanvas.stroke();
    } else if (type === 'Line') {
        labelCanvas.moveTo(5, 5);
        labelCanvas.lineTo(20, 20);
        labelCanvas.strokeStyle = color;
        labelCanvas.stroke();
    } else {
        labelCanvas.fillStyle = 'rgb(0, 0, 0)';
        labelCanvas.fillRect(5, 5, 20, 20);
        labelCanvas.strokeRect(5, 5, 20, 20);
    }
    $('#layer' + label).trigger('create');
    $('#' + label + 'slider').on('change', sliderEvent);
    $('#' + label + 'delete').on('click', deleteEvent);
    $('input[name=listCheckBox]').on('click', checkBoxEvent);
    $('#chkRoot' + label + ' > div').css('width', '80%');
    //$('#hrefRoot' + label + ' > span').css('margin', '-1.5px');
};

/**
 * 레이어 목록 삭제
 * @method removeList
 * @param {String} layerName - 레이어 이름
 */
OGDSM.mapLayerList.prototype.removeList = function (layerName) {
    'use strict';
    var labels = this.getLabels(),
        objs = this.getLayersObj();
    var layerNum = $.inArray(layerName, labels);

    labels.splice(layerNum, 1);
    objs.splice(layerNum, 1);
    $('#layer' + layerName).remove();
    $('#popup' + layerName).remove();
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 01 2016 18:44:34 GMT+0900 (KST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

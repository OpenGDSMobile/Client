<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>OGDSM_visualization.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="OGDSM.html">OGDSM</a></li><li><a href="OGDSM.attributeTable.html">attributeTable</a><ul class='methods'><li data-type='method'><a href="OGDSM.attributeTable.html#.getEidtMode">getEidtMode</a></li><li data-type='method'><a href="OGDSM.attributeTable.html#.getSelectObj">getSelectObj</a></li></ul></li><li><a href="OGDSM.chartVisualization.html">chartVisualization</a></li><li><a href="OGDSM.eGovFrameUI.html">eGovFrameUI</a></li><li><a href="OGDSM.externalConnection.html">externalConnection</a></li><li><a href="OGDSM.mapLayerList.html">mapLayerList</a></li><li><a href="OGDSM.visualization.html">visualization</a><ul class='methods'><li data-type='method'><a href="OGDSM.visualization.html#getLayersTitle">getLayersTitle</a></li></ul></li><li><a href="OGDSM.webSocket.html">webSocket</a></li></ul><h3>Modules</h3><ul><li><a href="OGDSM.module_applyOptions.html">applyOptions</a></li><li><a href="OGDSM.module_indexedDB.html">indexedDB</a></li><li><a href="OGDSM.module_jsontoArray.html">jsontoArray</a></li><li><a href="OGDSM.module_namespace.html">namespace</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addAttribute">addAttribute</a></li><li><a href="global.html#addList">addList</a></li><li><a href="global.html#addMap">addMap</a></li><li><a href="global.html#ajaxRequest">ajaxRequest</a></li><li><a href="global.html#areaChart">areaChart</a></li><li><a href="global.html#autoButton">autoButton</a></li><li><a href="global.html#autoCheckBox">autoCheckBox</a></li><li><a href="global.html#autoListView">autoListView</a></li><li><a href="global.html#autoRadioBox">autoRadioBox</a></li><li><a href="global.html#autoSelect">autoSelect</a></li><li><a href="global.html#autoSwitch">autoSwitch</a></li><li><a href="global.html#baseMapRadioBox">baseMapRadioBox</a></li><li><a href="global.html#baseMapSelect">baseMapSelect</a></li><li><a href="global.html#changeBaseMap">changeBaseMap</a></li><li><a href="global.html#changeWFSStyle">changeWFSStyle</a></li><li><a href="global.html#dataPortalEnvironment">dataPortalEnvironment</a></li><li><a href="global.html#dataPortalEnvironmentLoad">dataPortalEnvironmentLoad</a></li><li><a href="global.html#dataPortalGreenGas">dataPortalGreenGas</a></li><li><a href="global.html#dataPortalNuclear">dataPortalNuclear</a></li><li><a href="global.html#dateInput">dateInput</a></li><li><a href="global.html#formAjaxRequest">formAjaxRequest</a></li><li><a href="global.html#geoServerGeoJsonLoad">geoServerGeoJsonLoad</a></li><li><a href="global.html#getAttrObj">getAttrObj</a></li><li><a href="global.html#getCurTab">getCurTab</a></li><li><a href="global.html#getEidtMode">getEidtMode</a></li><li><a href="global.html#getLayersGeoServer">getLayersGeoServer</a></li><li><a href="global.html#getMap">getMap</a></li><li><a href="global.html#greenGasEmissionLoad">greenGasEmissionLoad</a></li><li><a href="global.html#hBarChart">hBarChart</a></li><li><a href="global.html#imageLayer">imageLayer</a></li><li><a href="global.html#indexOf">indexOf</a></li><li><a href="global.html#layerCheck">layerCheck</a></li><li><a href="global.html#lineChart">lineChart</a></li><li><a href="global.html#olMapView">olMapView</a></li><li><a href="global.html#publicDataInterface">publicDataInterface</a></li><li><a href="global.html#realTimeLevelofRadiationLoad">realTimeLevelofRadiationLoad</a></li><li><a href="global.html#removeAttribute">removeAttribute</a></li><li><a href="global.html#removeList">removeList</a></li><li><a href="global.html#removeMap">removeMap</a></li><li><a href="global.html#selectAttribute">selectAttribute</a></li><li><a href="global.html#seoulEnvironment">seoulEnvironment</a></li><li><a href="global.html#seoulEnvironmentLoad">seoulEnvironmentLoad</a></li><li><a href="global.html#setCurTab">setCurTab</a></li><li><a href="global.html#setSelectObj">setSelectObj</a></li><li><a href="global.html#setVisible">setVisible</a></li><li><a href="global.html#timeInput">timeInput</a></li><li><a href="global.html#trackingGeoLocation">trackingGeoLocation</a></li><li><a href="global.html#updateLayoutSetting">updateLayoutSetting</a></li><li><a href="global.html#vBarChart">vBarChart</a></li><li><a href="global.html#vworldWMSList">vworldWMSList</a></li><li><a href="global.html#vworldWMSLoad">vworldWMSLoad</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">OGDSM_visualization.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*jslint devel: true, vars : true, plusplus : true */
/*global $, jQuery, ol, OGDSM, d3*/
OGDSM.namesapce('visualization');
(function (OGDSM) {
    "use strict";
    var mapObj;
    /**
     * 오픈레이어3 지도 시각화 객체
     * @class OGDSM.visualization
     * @constructor
     * @param {String} mapDiv - 지도 DIV 아이디 이름
     * @param {JSON Object} options - 옵션 JSON 객체 키 값&lt;br>
    {layerListDiv:null, attrTableDiv:null, attrAddr:'', indexedDB:true}&lt;br>
    layerListDiv : 레이어 관리 리스트 DIV&lt;br>
    attrTableDiv : 속성 시각화 DIV 아이디 이름&lt;br>
    attrAddr : 속성 시각화 서버 주소&lt;br>
    indexedDB : 속성 정보 모바일 데이터베이스 저장 / 수정&lt;br>
    */
    OGDSM.visualization = function (mapDiv, options) {
        options = (typeof (options) !== 'undefined') ? options : {};
        var name;
        this.updateLayoutSetting(mapDiv);
        this.mapDiv = mapDiv;
        this.geoLocation = null;
        this.featureOverlay = null;
        OGDSM.visualization = this;
        var defaults = {
            layerListDiv : null,
            attrTableDiv : null,
            attrAddr : '',
            indexedDB : true
        };

        for (name in defaults) {
            if (defaults.hasOwnProperty(name)) {
                if (options.hasOwnProperty(name)) {
                    defaults[name] = options[name];
                }
            }
        }

        $(window).on('resize', function () {
            OGDSM.visualization.updateLayoutSetting();
        });
        if (defaults.attrTableDiv !== null) {
            this.attrTableObj = new OGDSM.attributeTable(defaults.attrTableDiv, defaults.attrAddr, this, defaults.indexedDB);
        }
        if (defaults.layerListDiv !== null) {
            this.layerListObj = new OGDSM.mapLayerList(this, defaults.layerListDiv, {
                attrObj : this.attrTableObj
            });
        }
        // Orientation...


    };
    OGDSM.visualization.prototype = {
        constructor : OGDSM.visualization,
        /**
         * 지도 객체 받기
         * @method getMap
         * @return {ol.Map} 오픈레이어3 객체
         */
        getMap : function () {
            return this.mapObj;
        },
        /**
         *
         *
         *
         */
        getLayersTitle : function () {
            var i,
                maps = this.getMap().getLayers().getArray(),
                arrObjs = [];
            for (i = 1; i &lt; maps.length; i += 1) {
                var objs = {};
                objs.id = i;
                objs.title = maps[i].get('title');
                arrObjs.push(objs);
            }
            return arrObjs;
        },
        /**
         * 지도 레이어 존재 여부 확인
         * @method layerCheck
         * @param {String} layerName - 레이어 이름
         * @return {OpenLayer3 Layer Object | Boolean} 레이어가 있을 경우 : 레이어 객체, 없을 경우 : false
         */
        layerCheck : function (layerName) {
            var i,
                maps = this.getMap().getLayers().getArray();
            for (i = 0; i &lt; maps.length; i += 1) {
                if (maps[i].get('title') === layerName) {
                    return maps[i];
                }
            }
            return false;
        },
        /**
         * 지도 레이어 인덱스 값
         * @method indexOf
         * @param {ol3 layers object} layers - 레이어 객체
         * @return {Number} 레이어 인덱스 값
         */
        indexOf : function (layers, layer) {
            var length = layers.getLength(), i;
            for (i = 0; i &lt; length; i++) {
                if (layer === layers.item(i)) {
                    return i;
                }
            }
            return -1;
        },
        /**
         * 속성정보 객체
         * @method getAttrObj
         * @return {attributeTable Object} 속성정보 객체
         */
        getAttrObj : function () {
            return this.attrTableObj;
        },
        getFeatureOverlay : function () {
            return this.featureOverlay;
        }
    };
    return OGDSM.visualization;
}(OGDSM));

/**
 * OpenGDS 모바일 맵 초기화
 * @method olMapView
 * @param {Array}  latlng  - 지도 초기 위,경도 값 (옵션) [default=[37.582200, 127.010031] ]
 * @param {String} mapType - 배경 지도 초기 값 (옵션) [default='OSM']
 * @param {String} baseProj  - 지도 투영 값 (옵션)   [default='EPSG:3857']
 * @return {ol.Map} openlayers3 ol.Map 객체
 */
OGDSM.visualization.prototype.olMapView = function (latlng, mapType, baseProj) {
    'use strict';
    latlng = (typeof (latlng) !== 'undefined') ? latlng : [37.582200, 127.010031];
    mapType = (typeof (mapType) !== 'undefined') ? mapType : 'OSM';
    baseProj = (typeof (baseProj) !== 'undefined') ? baseProj : 'EPSG:3857';
    var map = null, baseMapLayer = null, geolocation;
    var epsg5181 = new ol.proj.Projection({
        code : 'EPSG:5181',
        extent : [-219825.99, -535028.96, 819486.07, 777525.22],
        units : 'm'
    });
    var epsg5179 = new ol.proj.Projection({
        code : 'EPSG:5179',
        extent : [531371.84, 967246.47, 1576674.68, 2274021.31],
        units : 'm'
    });
    ol.proj.addProjection(epsg5181);
    ol.proj.addProjection(epsg5179);
    var baseView = new ol.View({
        projection : ol.proj.get(baseProj),
        center : ol.proj.transform(latlng, 'EPSG:4326', baseProj),
        zoom : 12,
        maxZoom : 18,
        minZoom : 6
    });
    map = new ol.Map({
        target : this.mapDiv,
        layers : [
            new ol.layer.Tile({
                title : 'basemap',
                source : baseMapLayer
            })
        ],
        view : baseView,
        controls: []
    });
    this.featureOverlay = new ol.FeatureOverlay({
        map : map,
        style : (function () {
            var styleStroke = new ol.style.Stroke({
                color : 'rgba(255, 0, 0, 1.0)',
                width : 3
            });
            return function (feature, resolution) {
                var type = feature.getGeometry().getType();
                var styleCircle = new ol.style.Circle({
                    radius : 10,
                    fill : feature.get('styleCircle').getFill(),
                    stroke : styleStroke
                });
                if (type === 'MultiPolygon') {
                    return [new ol.style.Style({
                        fill : feature.get('styleFill'),
                        stroke : styleStroke,
                        text : feature.get('styleText')
                    })];
                } else if (type === 'Point') {
                    return [new ol.style.Style({
                        image : styleCircle,
                        text : feature.get('styleText')
                    })];
                }
            };
        }())
    });
    var featureOverlay = this.featureOverlay;
    this.interaction = new ol.interaction.Select({
        layers : function (layer) {
            return true;
        },
        style : (function () {
            var styleStroke = new ol.style.Stroke({
                color : 'rgba(255, 0, 0, 1.0)',
                width : 3
            });
            return featureOverlay.getStyle();
        }())
    });
    map.addInteraction(this.interaction);
        /*
        function (feature, resolution) {
            var styleStroke = new ol.style.Stroke({
                color : 'rgba(255, 0, 0, 1.0)',
                width : 3
            });
            return [new ol.style.Style({
                fill : feature.get('styleFill'),
                stroke : styleStroke,
                text : feature.get('styleText')
            })];
        */
    this.mapObj = map;
    this.baseProj = baseProj;
    this.changeBaseMap(mapType);
    this.mapObj.updateSize();
    return this.mapObj;
};


/**
 * 배경지도 변경
 * @method changeBaseMap
 * @param {String} mapStyle - 지도 스타일 이름 ("OSM" | "VWorld" | "VWorld_m" | "VWorld_h")
 */
OGDSM.visualization.prototype.changeBaseMap = function (mapStyle) {
    "use strict";
    var TMS = null, view = null, baseLayer = null, map = this.mapObj, maplayers = map.getLayers(),
        mapCenter = map.getView().getCenter(), mapZoom = map.getView().getZoom(), mapProj = map.getView().getProjection();

    maplayers.forEach(function (obj, i) {
        var layerTitle = obj.get('title');
        if (layerTitle === 'basemap') {
            baseLayer = obj;
        }
    });
    if (mapStyle === 'OSM') {
        TMS = new ol.source.OSM();
        view = new ol.View({
            projection : mapProj,
            center : mapCenter,
            zoom : mapZoom
        });
    } else if (mapStyle === 'VWorld') {
        TMS = new ol.source.XYZ(({
            url : "http://xdworld.vworld.kr:8080/2d/Base/201310/{z}/{x}/{y}.png"
        }));
        view = new ol.View({
            projection : mapProj,
            center : mapCenter,
            zoom : mapZoom,
            maxZoom : 18,
            minZoom : 6
        });
    } else if (mapStyle === 'VWorld_s') {
        TMS = new ol.source.XYZ(({
            url : "http://xdworld.vworld.kr:8080/2d/Satellite/201301/{z}/{x}/{y}.jpeg"
        }));
        view = new ol.View({
            projection : mapProj,
            center : mapCenter,
            zoom : mapZoom,
            maxZoom : 18,
            minZoom : 6
        });
    } else if (mapStyle === 'VWorld_g') {
        TMS = new ol.source.XYZ(({
            url : "http://xdworld.vworld.kr:8080/2d/gray/201411/{z}/{x}/{y}.png"
        }));
        view = new ol.View({
            projection : mapProj,
            center : mapCenter,
            zoom : mapZoom,
            maxZoom : 18,
            minZoom : 6
        });
    } else if (mapStyle === 'VWorld_m') {
        TMS = new ol.source.XYZ(({
            url : "http://xdworld.vworld.kr:8080/2d/midnight/201411/{z}/{x}/{y}.png"
        }));
        view = new ol.View({
            projection : mapProj,
            center : mapCenter,
            zoom : mapZoom,
            maxZoom : 18,
            minZoom : 6
        });
    } else if (mapStyle === '') {
        TMS = null;
        view = new ol.View({
            projection : mapProj,
            center : mapCenter,
            zoom : mapZoom,
            maxZoom : 18,
            minZoom : 6
        });
    } else {
        console.error('Not Map Style "OSM" | "VWorld" | "VWorld_m" | "VWorld_h"');
        return null;
    }
    if (baseLayer !== null) {
        map.setView(view);
        baseLayer.setSource(TMS);
    }
};

/**
 * 지도 GPS 트래킹 스위치
 * @method trackingGeoLocation
 * @param {boolean} sw - Geolocation 스위치 (true | false)
 **/
OGDSM.visualization.prototype.trackingGeoLocation = function (sw) {
    'use strict';
    var geolocation = this.geoLocation, mapObj = this.mapObj;
    if (typeof (this.mapObj) === 'undefined') {
        console.error('Not Create Map!!');
        return null;
    }
    if (geolocation === null) {
        geolocation = new ol.Geolocation({
            projection:	mapObj.getView().getProjection(),
            tracking : true
        });
    }

    if (sw === true) {
        geolocation.once('change:position', function () {
            mapObj.getView().setCenter(geolocation.getPosition());
        });
    }
};
/**
 * 해상도에 맞는 지도 레이아웃
 * @method updateLayoutSetting
 * @param {String} mapDiv - 지도 DIV 아이디 이름
 **/
OGDSM.visualization.prototype.updateLayoutSetting = function (mapDiv) {
    'use strict';
    mapDiv = (typeof (mapDiv) !== 'undefined') ? mapDiv : this.mapDiv;
    if (typeof (this.mapObj) !== 'undefined') {
        this.mapObj.updateSize();
    }
};

/**
 * WMS 및 WFS 맵 레이어 추가
 * @method addMap
 * @param {ol Map Object} data - 오픈레이어3 지도 객체
 */
OGDSM.visualization.prototype.addMap = function (data) {
    'use strict';
    var chkData = this.layerCheck(data.get('title'));
    var featureOverlay = this.featureOverlay;
    var interaction = this.interaction;
    var mapObj = this.getMap();
    if (chkData === true) {
        console.log("OpenGDS Mobile : Layer is existence");
        return -1;
    }
    mapObj.addLayer(data);
    featureOverlay.getFeatures().clear();
    /*layer list On*/
    if (typeof (this.layerListObj) !== 'undefined') {
        var color;
        var geometryObj = data.getSource().getFeatures()[0].getGeometry();
        var geoType = geometryObj.getType();
        if (typeof data.getStyle !== 'undefined') {
            color = data.get('styleFill');
        } else {
            color =  'rgb(0, 0, 0)';
        }
        this.layerListObj.addList(data, data.get('title'), color, geoType);
    }
    /*attribute On*/
    if (typeof (this.attrTableObj) !== 'undefined') {
        var attrTableObj = this.attrTableObj;
        attrTableObj.addAttribute(data.get('title'));
        interaction.getFeatures().on('add', function (event) {
            var label = event.target.item(0).get('label');
            var selectValue = event.target.item(0).get(label);
            featureOverlay.getFeatures().clear();
            attrTableObj.selectAttribute(data.get('title'), label, selectValue, attrTableObj);
        });
        featureOverlay.getFeatures().on('add', function (event) {
            attrTableObj.unSelectAttribute(attrTableObj);
            mapObj.removeInteraction(interaction);
            mapObj.addInteraction(interaction);
        });
    }

};
/**
 * 이미지 레이어 시각화
 * @method imageLayer
 * @param {String} imgURL - 이미지 주소
 * @param {String} imgTitle - 이미지 타이틀
 * @param {Array} imgSize - 이미지 사이즈 [width, height]
 * @param {Array} imgExtent - 이미지 위치 [lower left lon, lower left lat, upper right lon, upper right lat] or [left, bottom, right, top]
 */
OGDSM.visualization.prototype.imageLayer = function (imgURL, imgTitle, imgSize, imgExtent) {
    'use strict';
    var imgLayer = null,
        title = imgTitle;

    imgLayer = new ol.layer.Image({
        opacity : 1.0,
        title : title,
        source : new ol.source.ImageStatic({
            url : imgURL + '?' + Math.random(),
            imageSize : imgSize,
            projection : new ol.proj.Projection({code : 'EPSG:3857'}),
            imageExtent : imgExtent

        })
    });
    this.getMap().addLayer(imgLayer);
};
/**
 * 맵 레이어 삭제
 * @method removeMap
 * @param {String} layerName - 레이어 이름
 */
OGDSM.visualization.prototype.removeMap = function (layerName) {
    'use strict';
    var obj = this.layerCheck(layerName);
    if (obj !== false) {
        this.getMap().removeLayer(obj);
        if (typeof (this.layerListObj) !== 'undefined') {
            this.layerListObj.removeList(layerName);
        }
    }
};
/**
 * 맵 레이어 시각화 여부
 * @method setVisible
 * @param {String} layerName - 레이어 이름
 * @param {Boolean} flag - 시각화 스위치 [true | false}
 */
OGDSM.visualization.prototype.setVisible = function (layerName, flag) {
    'use strict';
    var obj = this.layerCheck(layerName);
    if (obj !== false) {
        obj.setVisible(flag);
    }
};
/**
 * WFS 스타일 변경
 * @method changeWFSStyle
 * @param {String} layerName - 오픈레이어3 레이어 이름
 * @param {Hex Color, String or Array} colors - 변경할 색상
 * @param {JSON Object} options - 옵션 JSON 객체 키 값 {type:'polygon', opt : '0.5', attr: null, range: null, xyData: null}&lt;br>
  type(String) : 객체 타입 (polygon, point)&lt;br>
  opt(Number) : 레이어 투명도 &lt;br>
  attr(String) : 속성 이름 &lt;br>
  range(Array) : 색상 범위&lt;br>
  xyData(Array) : 색상 데이터&lt;br>
 */
OGDSM.visualization.prototype.changeWFSStyle = function (layerName, colors, options) {
    'use strict';
    var i = null, name,
        map = this.layerCheck(layerName),
        styleCache = {},
        style = null;
    options = (typeof (options) !== 'undefined') ? options : {};
    var defaults = {
        type : 'polygon',
        opt : 0.5,
        attr : null,
        range : null,
        data : null,
        rootKey : null,
        labelKey : null,
        valueKey : null
    };

    for (name in defaults) {
        if (defaults.hasOwnProperty(name)) {
            if (options.hasOwnProperty(name)) {
                defaults[name] = options[name];
            }
        }
    }
    if (map === false) {
        console.error('Not Map Layer');
        return -1;
    }
    var data = defaults.data[defaults.rootKey];
    map.setStyle(function (f, r) {
        var i,
            j,
            color = '#FFFFFF',
            text = r &lt; 5000 ? f.get(defaults.attr) : '';
        if (!styleCache[text]) {
            if (Array.isArray(colors)) {
                for (i = 0; i &lt; data.length; i += 1) {
                    if (text === data[i][defaults.labelKey]) {
                        for (j = 0; j &lt; defaults.range.length; j += 1) {
                            if (data[i][defaults.valueKey] &lt;= defaults.range[j]) {
                                color = colors[j];
                                break;
                            }
                        }
                    }
                }
            } else {
                color = colors;
            }
            if (defaults.type === 'polygon') {
                styleCache[text] = [new ol.style.Style({
                    fill : new ol.style.Fill({
                        color : color
                    }),
                    stroke : new ol.style.Stroke({
                        color : '#00000',
                        width : 1
                    }),
                    text : new ol.style.Text({
                        font : '9px Calibri,sans-serif',
                        text : text,
                        fill : new ol.style.Fill({
                            color : '#000000'
                        })
                    })
                })];
            } else if (defaults.type === 'point') {
                styleCache[text] = [new ol.style.Style({
                    image : new ol.style.Circle({
                        radius : 5,
                        fill : new ol.style.Fill({
                            color : color
                        }),
                        stroke : new ol.style.Stroke({
                            color : '#000000',
                            width : 1
                        })
                    })
                })];
            }


        }
        return styleCache[text];
    });
    map.setOpacity(defaults.opt);
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 01 2016 18:44:34 GMT+0900 (KST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

<!DOCTYPE html>

<html>
    <head>
        <base href="../">
        <title>공공데이터포털 Example</title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="./css/egovframework/mbl/cmm/jquery.mobile-1.3.2.css">   <!-- jQuery Mobile -->
        <link rel="stylesheet" href="./css/egovframework/mbl/cmm/EgovMobile-1.3.2.css">      <!-- eGov Mobile -->
        <link type="text/css" rel="stylesheet" href="./css/ol3/ol.css">                      <!-- OpenLayers 3 -->
        <link rel="stylesheet" href="css/syntaxhighlighter/shCore.css">
        <link rel="stylesheet" href="css/syntaxhighlighter/shCoreDefault.css">

        <script type="text/javascript" src="./js/egovframework/mbl/cmm/jquery-1.9.1.min.js"></script>      <!-- jQuery -->
        <script type="text/javascript" src="./js/egovframework/mbl/cmm/jquery.mobile-1.3.2.min.js"></script> <!-- jQuery Mobile -->
        <script type="text/javascript" src="./js/egovframework/mbl/cmm/EgovMobile-1.3.2.js"></script>      <!-- eGov Mobile -->

        <!-- Proj, OpenLayers3, D3 -->
        <script type="text/javascript" src="./js/proj4js/2.2.2/proj4.js"></script>                         <!-- Proj4js -->
        <script type="text/javascript" src="./js/ol3/ol.js"></script>                                      <!-- OpenLayers 3 -->
        <script type="text/javascript" src="./js/d3/d3.js"></script>                                       <!-- D3.js -->
        <script type="text/javascript" src="./js/OpenGDSMobileLib/openGDSMobileClient1.2.min.js"></script> <!-- OpenGDS Mobile -->

        <script type="text/javascript" src="./js/syntaxhighlighter/shCore.js"></script>
        <script type="text/javascript" src="./js/syntaxhighlighter/shBrushXml.js"></script>
        <script type="text/javascript" src="./js/syntaxhighlighter/shBrushJScript.js"></script>
        <script type="text/javascript" src="./js/syntaxhighlighter/shBrushCss.js"></script>
        <style>
            html, body{
                height:100%;
            }
            .OGDSPosTopCenter{
            	position : absolute;
            	z-index : 999;
                width : 200px;
            	top : 25px;
            	left : 45%;
            	right : 45%;
            }
        </style>

        <script>
            SyntaxHighlighter.all();
            var obj = null;
            function DatPortalUI() {
                $('#setting').empty();
                var serverAddr = 'http://113.198.80.9/MobileWebMapping';
                var geoServerAddr = 'http://113.198.80.9';
                var ui = new OGDSM.eGovFrameUI();
                var envIds = ui.dataProtalEnvironment('setting', {path : './images/openGDSMobile/'});
                var processBtn = ui.autoButton('setting', 'vworldProcess', 'Process', '#', {
                    theme : 'a'
                });
                var externalServer = new OGDSM.externalConnection();
                var colors = ['#0090ff', '#008080', '#4cff4c', '#99ff99', '#FFFF00', '#FFFF99', '#FF9900', '#FF0000'],
                    ranges = [ [15, 30, 55, 80, 100, 120, 200],    //PM10, PM25
                              [1, 2, 5.5, 9, 10.5, 12, 15],        //CO
                              [0.015, 0.03, 0.05, 0.06, 0.1045, 0.15, 0.2],    //NO2
                              [0.01, 0.02, 0.035, 0.05, 0.075, 0.1, 0.15],     //SO2
                              [0.02, 0.04, 0.06, 0.08, 0.10, 0.12, 0.3] ];     //O3
                processBtn.click(function () {
                    $('#setting').popup("close");
                    var apiKey = 'kCxEhXiTf1qmDBlQFOOmw%2BemcPSxQXn5V5%2Fx8EthoHdbSojIdQvwX%2BHtWFyuJaIco0nUJtu12e%2F9acb7HeRRRA%3D%3D',
                        addr = serverAddr + '/PublicDataPortal.do';
                    var visualType = $('input[name=' + envIds[0].attr('name') + ']:checked').val(),
                        environmentType = $('input[name=' + envIds[2].attr('name') + ']:checked').val(),
                        area = $('input[name=' + envIds[1].attr('name') + ']:checked').val(),
						text = $('input[name=' + envIds[1].attr('name') + ']:checked').next().text().replace(/\s/g,"");
                    switch (environmentType) {
                    case 'pm10Value':
                        ranges = ranges[0];
                        break;
                    case 'pm25Value':
                        ranges = ranges[0];
                        break;
                    case 'coValue':
                        ranges = ranges[1];
                        break;
                    case 'no2Value':
                        ranges = ranges[2];
                        break;
                    case 'so2Value':
                        ranges = ranges[3];
                        break;
                    case 'o3Value':
                        ranges = ranges[4];
                        break;
                    }
                    externalServer.dataPortalEnvironmentLoad(addr, apiKey, environmentType, text, function (resultData) {
                        var xyData = OGDSM.jsonToArray(resultData, environmentType, 'stationName');
                        if (visualType === 'map') {
                            console.log("test");
                            externalServer.geoServerWFSLoad(obj, geoServerAddr, 'opengds', area+'_sig', {
                                callback : function (layer) {
                                	obj.changeWFSStyle(area+'sig', colors, {
                                        opt : 0.6,
                                        attr : 'sig_kor_nm',
                                        range : ranges,
                                        xyData : xyData
                                    });
                                }
                            });
                        } else if (visualType === 'chart') {
                            obj.barChart("d3View", xyData, ranges, colors);
                            $('#dataSelect').popup('open');
                        }
                    });
                });
            }
            $(function(){
                obj = new OGDSM.visualization('map');
                obj.olMapView([127.010031, 37.582200]);
            });
        </script>
    </head>

    <body>
        <div data-role="page">
            <div data-role="header" data-theme="b">
                OpenGDS Mobile Client Example
            </div>
            <div data-role="content" style="padding:0; margin:0;">
                <div id="map" style="width:100%; height:400px;"></div>
	            <a href="#setting" data-role="button" data-rel="popup" data-mini="true" data-inline="true" class="OGDSPosTopCenter" data-position-to="window" onclick="DatPortalUI()">공공데이터포털(환경데이터)</a>
                <h3 style="margin-left:10px;">공공데이터포털(환경데이터)</h3>
                <p style="font-size:12px; margin-left:25px;">
                설명~~
                </p>
                <p style="margin-left:25px;">Code</p>
                <pre class="brush:html;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html;charset=utf-8" /&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"&gt;
        &lt;link rel="stylesheet" href="css/egovframework/mbl/cmm/jquery.mobile-1.3.2.css"&gt;   <!-- jQuery Mobile -->
        &lt;link rel="stylesheet" href="css/egovframework/mbl/cmm/EgovMobile-1.3.2.css"&gt;      <!-- eGov Mobile -->
        &lt;link type="text/css" rel="stylesheet" href="css/ol3/ol.css"&gt;                      <!-- OpenLayers 3 -->

        &lt;script type="text/javascript" src="js/egovframework/mbl/cmm/jquery-1.9.1.min.js"&gt;&lt;/script&gt;      <!-- jQuery -->
        &lt;script type="text/javascript" src="js/egovframework/mbl/cmm/jquery.mobile-1.3.2.min.js"&gt;&lt;/script&gt; <!-- jQuery Mobile -->
        &lt;script type="text/javascript" src="js/egovframework/mbl/cmm/EgovMobile-1.3.2.js"&gt;&lt;/script&gt;      <!-- eGov Mobile -->

        <!-- Proj, OpenLayers3, D3 -->
        &lt;script type="text/javascript" src="js/proj4js/2.2.2/proj4.js"&gt;&lt;/script&gt;                         <!-- Proj4js -->
        &lt;script type="text/javascript" src="js/ol3/ol.js"&gt;&lt;/script&gt;                                      <!-- OpenLayers 3 -->
        &lt;script type="text/javascript" src="js/d3/d3.js"&gt;&lt;/script&gt;                                       <!-- D3.js -->
        &lt;script type="text/javascript" src="js/OpenGDSMobileLib/openGDSMobileClient1.2.min.js"&gt;&lt;/script&gt; <!-- OpenGDS Mobile -->
        &lt;style&gt;
            ... (CSS 내용)
        &lt;/style&gt;
        &lt;script&gt;
            ... (script 내용)
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="map" style="width:100%; height:400px;"&gt;
	    &lt;a href="#setting" data-role="button" data-rel="popup" data-mini="true" data-inline="true" class="OGDSPosTopCenter" data-position-to="window" onclick="DataPortalUI()"&gt;공공데이터포털(환경데이터)&lt;/a&gt;

        &lt;div data-role="popup" id="dataSelect" data-overlay-theme="a"&gt;
            &lt;div id="range"&gt;
                &lt;table style="margin:0 auto"&gt;
                    &lt;tr&gt;
                        &lt;td style="background:#0090ff; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td style="background:#008080; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td>&lt;span class="font"&gt;Good&lt;/span&gt;&lt;/td&gt;
                        &lt;td style="background:#4CFF4C; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td style="background:#99FF99; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td&gt;&lt;span class="font">Normal&lt;/span&gt; &lt;/td&gt;
                        &lt;td style="background:#FFFF00; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td style="background:#FFFF99; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td&gt;&lt;span class="font"&gt;Sensitive&lt;/span&gt;&lt;/td&gt;
                        &lt;td style="background:#FF9900; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td&gt;&lt;span class="font"&gt;Bad&lt;/span&gt;&lt;/td&gt;
                        &lt;td style="background:#FF0000; margin:0; padding:0"&gt;　&lt;/td&gt;
                        &lt;td&gt;&lt;span class="font"&gt;Very Bad&lt;/span&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/div&gt;
            &lt;div id="d3View"&gt; &lt;/div&gt;
        &lt;/div>

        &lt;div id="setting" data-role="popup" data-overlay-theme="a"
        style="width:250px; text-align:center; align:center;"&gt;
        &lt;/div&gt;

    &lt;/body&gt;
&lt;/html&gt;
                </pre>
                <p style="margin-left:25px;">CSS 내용</p>
                <pre class="brush:css;">
                .OGDSPosTopCenter{
                    position : absolute;
                    z-index : 999;
                    width : 200px;
                    top : 25px;
                    left : 45%;
                    right : 45%;
                }
                </pre>
                <p style="margin-left:25px;">script 내용</p>
                <pre class="brush:js;">

            var obj = null;
            function DatPortalUI() {
                $('#setting').empty();
                var serverAddr = 'http://113.198.80.9';
                var geoServerAddr = 'http://113.198.80.9';
                var ui = new OGDSM.eGovFrameUI();
                var envIds = ui.dataProtalEnvironment('setting', {path : '../images/openGDSMobile/'});
                var processBtn = ui.autoButton('setting', 'vworldProcess', 'Process', '#', {
                    theme : 'a'
                });
                var externalServer = new OGDSM.externalConnection();
                var colors = ['#0090ff', '#008080', '#4cff4c', '#99ff99', '#FFFF00', '#FFFF99', '#FF9900', '#FF0000'],
                    ranges = [ [15, 30, 55, 80, 100, 120, 200],    //PM10, PM25
                              [1, 2, 5.5, 9, 10.5, 12, 15],        //CO
                              [0.015, 0.03, 0.05, 0.06, 0.1045, 0.15, 0.2],    //NO2
                              [0.01, 0.02, 0.035, 0.05, 0.075, 0.1, 0.15],     //SO2
                              [0.02, 0.04, 0.06, 0.08, 0.10, 0.12, 0.3] ];     //O3
                processBtn.click(function () {
                    $('#setting').popup("close");
                    var apiKey = 'kCxEhXiTf1qmDBlQFOOmw%2BemcPSxQXn5V5%2Fx8EthoHdbSojIdQvwX%2BHtWFyuJaIco0nUJtu12e%2F9acb7HeRRRA%3D%3D',
                        addr = serverAddr + '/PublicDataPortal.do';
                    var visualType = $('input[name=' + envIds[0].attr('name') + ']:checked').val(),
                        environmentType = $('input[name=' + envIds[2].attr('name') + ']:checked').val(),
                        area = $('input[name=' + envIds[1].attr('name') + ']:checked').val(),
						text = $('input[name=' + envIds[1].attr('name') + ']:checked').next().text().replace(/\s/g,"");
                    switch (environmentType) {
                    case 'pm10Value':
                        ranges = ranges[0];
                        break;
                    case 'pm25Value':
                        ranges = ranges[0];
                        break;
                    case 'coValue':
                        ranges = ranges[1];
                        break;
                    case 'no2Value':
                        ranges = ranges[2];
                        break;
                    case 'so2Value':
                        ranges = ranges[3];
                        break;
                    case 'o3Value':
                        ranges = ranges[4];
                        break;
                    }
                    externalServer.dataPortalEnvironmentLoad(addr, apiKey, environmentType, text, function (resultData) {
                        var xyData = OGDSM.jsonToArray(resultData, environmentType, 'stationName');
                        if (visualType === 'map') {
                            externalServer.geoServerWFSLoad(openGDSMObj, geoServerAddr, 'opengds', area+'_sig', {
                                callback : function (layer) {
                                    obj.changeWFSStyle(area+'_sig', colors, {
                                        opt : 0.6,
                                        attr : 'sig_kor_nm',
                                        range : ranges,
                                        xyData : xyData
                                    });
                                }
                            });
                        } else if (visualType === 'chart') {
                            obj.barChart("d3View", xyData, ranges, colors);
                            $('#dataSelect').popup('open');
                        }
                    });
                });
            }
            $(function(){
                obj = new OGDSM.visualization('map');
                obj.olMapView([127.010031, 37.582200]);
            });

                </pre>

            </div>


            <div id="setting"
            data-role="popup"
            data-overlay-theme="a"
            style="width:250px; text-align:center; align:center;">
            </div>

            <div data-role="popup" id="dataSelect" data-overlay-theme="a">
              <div id="range">
                            <table style="margin:0 auto">
                                <tr>
                                    <td style="background:#0090ff; margin:0; padding:0">　</td>
                                    <td style="background:#008080; margin:0; padding:0">　</td>
                                    <td><span class="font">Good</span></td>
                                    <td style="background:#4CFF4C; margin:0; padding:0">　</td>
                                    <td style="background:#99FF99; margin:0; padding:0">　</td>
                                    <td><span class="font">Normal</span></td>
                                    <td style="background:#FFFF00; margin:0; padding:0">　</td>
                                    <td style="background:#FFFF99; margin:0; padding:0">　</td>
                                    <td><span class="font">Sensitive</span></td>
                                    <td style="background:#FF9900; margin:0; padding:0">　</td>
                                    <td><span class="font">Bad</span></td>
                                    <td style="background:#FF0000; margin:0; padding:0">　</td>
                                    <td><span class="font">Very Bad</span></td>
                                </tr>
                            </table>
                </div>
                <div id="d3View"> </div>
            </div>
        </div>
    </body>
</html>
